<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DOCTOR QUEST: MEDICAL SCHOOL</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap');
*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent;touch-action:none}
:root{
--blue:#3498db;--green:#2ecc71;--red:#e74c3c;--yellow:#f1c40f;
--purple:#9b59b6;--cyan:#00e5ff;--gold:#f0c040;--orange:#e67e22;
--bg:#07070f;--surface:#0e0e1a;--text:#c8c8d8;
--wall:#1a1a30;--wall2:#22223a;
--mono:'Share Tech Mono',monospace;--display:'VT323',monospace;
}
body{overflow:hidden;background:var(--bg);font-family:var(--mono);color:var(--text);touch-action:none;overscroll-behavior:none}
canvas{display:block;image-rendering:pixelated}
#ui{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;font-family:var(--mono)}

/* HUD */
.hud{position:absolute;background:rgba(7,7,15,0.92);border:1px solid #1e1e38;
padding:4px 8px;border-radius:3px;pointer-events:none;z-index:100;
font-size:11px;letter-spacing:1px;backdrop-filter:blur(6px);
box-shadow:0 0 10px rgba(0,229,255,0.1)}
#hYear{top:8px;left:8px;color:#aaa}
#hLevel{top:8px;left:80px;color:#aaa}
#hScore{top:8px;right:50px;color:var(--gold)}
#hStreak{top:28px;right:8px;color:var(--orange);font-size:10px;display:none}
#hStreak.active{display:block;animation:streakGlow 2s infinite}

/* Save Indicator */
#saveIndicator{position:absolute;top:45px;left:8px;background:rgba(46,204,113,0.2);
border:1px solid var(--green);padding:4px 10px;border-radius:3px;
font-size:9px;color:var(--green);z-index:100;opacity:0;transition:opacity .3s;
display:flex;align-items:center;gap:5px}
#saveIndicator.show{opacity:1}

/* Progress Bar */
.prog-wrap{position:absolute;top:32px;left:8px;width:160px;height:4px;
background:#111;border:1px solid #222;border-radius:2px;z-index:100;
box-shadow:0 0 8px rgba(0,0,0,0.5)}
.prog-fill{height:100%;border-radius:2px;transition:width .4s;
background:linear-gradient(90deg,var(--blue),var(--cyan));
box-shadow:0 0 10px rgba(0,229,255,0.5)}

/* Question Dots */
.q-dots{position:absolute;top:42px;left:8px;display:flex;gap:5px;z-index:100}
.q-dot{width:8px;height:8px;border-radius:50%;border:1px solid #334;background:#111;transition:all .3s}
.q-dot.lit{background:var(--green);border-color:var(--green);box-shadow:0 0 8px var(--green);animation:dotPulse 1s infinite}

/* Narrator */
#narrator{position:absolute;top:12%;left:50%;transform:translateX(-50%);
background:rgba(10,10,20,0.94);border:1px solid #2a2a50;border-radius:4px;
padding:8px 20px;font-style:italic;font-size:12px;opacity:0;
transition:opacity .4s;z-index:99;pointer-events:none;max-width:85%;text-align:center;
color:#8080b0;box-shadow:0 0 20px rgba(0,200,255,0.15)}

/* Pause Button */
#pauseBtn{position:absolute;top:8px;right:8px;width:36px;height:36px;
background:rgba(14,14,26,0.92);border:1px solid #1e1e38;border-radius:50%;
color:#888;font-size:12px;display:flex;align-items:center;justify-content:center;
pointer-events:auto;z-index:200;cursor:pointer;transition:all .2s;
box-shadow:0 0 10px rgba(0,0,0,0.3)}
#pauseBtn:hover{color:#ccc;border-color:#444;transform:scale(1.05)}

/* Overlay Panels */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(5,5,12,0.98);display:flex;flex-direction:column;
align-items:center;justify-content:center;z-index:300;
pointer-events:none;opacity:0;transition:opacity .35s;
backdrop-filter:blur(8px)}
.overlay.active{pointer-events:auto;opacity:1}

/* Question Panel */
#qPanel{z-index:400}
.q-box{background:linear-gradient(135deg,#0b0b18,#0f0f22);border:1px solid #252545;border-radius:12px;
padding:24px;max-width:92%;width:94%;max-height:88vh;overflow-y:auto;
box-shadow:0 0 60px rgba(0,229,255,0.15);position:relative;overflow:hidden}
.q-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;
background:linear-gradient(90deg,var(--blue),var(--cyan),var(--blue));
background-size:200% 100%;animation:gradientShift 3s infinite}

.q-title{font-family:var(--display);font-size:1.5rem;color:var(--cyan);
text-align:center;margin-bottom:14px;letter-spacing:2px}

.q-year-badge{display:inline-block;background:rgba(52,152,219,.15);
border:1px solid var(--blue);border-radius:4px;padding:4px 10px;
font-size:10px;color:var(--blue);letter-spacing:2px;margin-bottom:12px}

.q-text{font-size:14px;line-height:1.7;margin-bottom:16px;text-align:center;color:#ddd;
font-weight:500;padding:10px;background:rgba(0,0,0,0.3);border-radius:6px;
border-left:3px solid var(--cyan)}

.q-opts{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
.q-btn{background:rgba(12,12,22,0.92);border:1px solid #222240;color:#888899;
padding:11px 16px;font-family:var(--mono);font-size:12px;letter-spacing:.5px;
border-radius:6px;cursor:pointer;transition:all .2s;width:100%;text-align:left}
.q-btn:hover{background:#14142a;border-color:#3a3a60;color:#bbbbd0;transform:translateX(4px)}
.q-btn.correct{background:rgba(46,204,113,.25);border-color:var(--green);color:#aaffbb}
.q-btn.wrong{background:rgba(231,76,60,.25);border-color:var(--red);color:#ffaaaa}

.q-feedback{font-size:14px;text-align:center;margin-top:10px;min-height:24px;font-weight:bold;padding:8px;border-radius:4px}
.q-feedback.correct{background:rgba(46,204,113,0.15);color:var(--green);border:1px solid var(--green)}
.q-feedback.wrong{background:rgba(231,76,60,0.15);color:var(--red);border:1px solid var(--red)}

.q-explanation{background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.3);
border-radius:6px;padding:12px;margin-top:12px;font-size:12px;color:#88ccdd;
display:none;line-height:1.6}
.q-explanation.show{display:block}

#skipBtn{display:block;margin:12px auto 0;background:linear-gradient(135deg,#0d0d1e,#1a1a2e);
border:1px solid #1e1e3e;color:#5555aa;padding:9px 24px;font-family:var(--mono);
font-size:.75rem;letter-spacing:2px;border-radius:6px;cursor:pointer;
transition:all .2s;text-transform:uppercase}
#skipBtn:hover{border-color:var(--blue);color:#8888cc}
#skipBtn:disabled{opacity:0.4;cursor:not-allowed}

.skip-bar-wrap{width:100%;height:3px;background:#111;border-radius:2px;margin-top:6px;overflow:hidden}
.skip-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--cyan));
border-radius:2px;transition:width .1s linear}

/* Pause Menu */
#pauseMenu h2{font-family:var(--display);font-size:clamp(2rem,6vw,3.2rem);color:var(--blue);
letter-spacing:2px;margin-bottom:16px}
.menu-btn{background:linear-gradient(135deg,rgba(12,12,22,0.92),rgba(20,20,35,0.92));
border:1px solid #2a2a4a;color:var(--text);
padding:13px 40px;font-family:var(--mono);font-size:.8rem;letter-spacing:2px;
border-radius:6px;cursor:pointer;transition:all .2s;width:85%;text-align:center;
text-transform:uppercase;margin:5px 0}
.menu-btn:hover{background:#14142a;border-color:var(--blue);color:#dde;transform:translateY(-3px)}
.menu-btn.danger{border-color:#2a1010;color:#ff9999}
.menu-btn.danger:hover{border-color:var(--red);background:#1a0a0a}

/* Save Info in Pause */
.save-info{background:rgba(52,152,219,0.1);border:1px solid var(--blue);
border-radius:6px;padding:10px;margin:10px 0;width:85%;font-size:11px;color:#88ccdd}
.save-info-label{color:#aaa;margin-bottom:4px}
.save-info-value{color:var(--cyan);font-weight:bold}

/* Title Screen */
#title{position:absolute;top:0;left:0;width:100%;height:100%;
background:radial-gradient(ellipse at 50% 60%,#0c1824 0%,var(--bg) 70%);
display:flex;flex-direction:column;align-items:center;justify-content:center;
z-index:1000;transition:opacity .6s}
.t-pre{font-family:var(--display);font-size:clamp(.8rem,2.5vw,1.1rem);color:#2a7a7a;
letter-spacing:5px;margin-bottom:8px;animation:pulse 4s infinite}
#mainTitle{font-family:var(--display);font-size:clamp(2.5rem,12vw,6rem);color:var(--cyan);
letter-spacing:3px;text-align:center;
text-shadow:0 0 25px rgba(0,229,255,.5),0 0 50px rgba(0,229,255,.25);
line-height:1;margin-bottom:6px;animation:glow 3s infinite}
.t-sub{font-family:var(--mono);font-size:11px;color:#2a7070;letter-spacing:3px;margin-bottom:20px}

/* Player Name Input */
.name-input-wrap{margin-bottom:15px;text-align:center}
.name-input-wrap label{display:block;color:#888;font-size:10px;letter-spacing:2px;margin-bottom:6px}
#playerNameInput{background:rgba(12,12,22,0.92);border:1px solid #2a2a4a;
color:var(--cyan);padding:10px 20px;font-family:var(--mono);font-size:13px;
letter-spacing:2px;border-radius:6px;text-align:center;width:220px;
text-transform:uppercase}
#playerNameInput:focus{outline:none;border-color:var(--cyan);box-shadow:0 0 15px rgba(0,229,255,0.3)}

.t-btns{display:flex;flex-direction:column;align-items:center;gap:10px}
.t-btn{background:linear-gradient(135deg,rgba(12,12,22,0.92),rgba(20,20,35,0.92));
border:1px solid #1e1e3e;color:#78cccc;
padding:13px 44px;font-family:var(--mono);font-size:.8rem;letter-spacing:2.5px;
border-radius:6px;cursor:pointer;transition:all .25s;width:88%;text-align:center;
text-transform:uppercase}
.t-btn:hover{background:#14141e;border-color:var(--cyan);color:#ddffff;transform:scale(1.02) translateY(-2px)}
.t-btn.primary{border-color:#1a5060;color:#aaffe0}
.t-btn.continue{border-color:var(--green);color:var(--green);
box-shadow:0 0 20px rgba(46,204,113,0.3)}
.t-btn.continue:hover{box-shadow:0 0 35px rgba(46,204,113,0.5)}
.t-btn.lang{border-color:#3a3a7a;color:#ccccff}

/* Save Info Display */
#saveInfo{background:rgba(46,204,113,0.1);border:1px solid var(--green);
border-radius:6px;padding:10px 15px;margin-top:12px;font-size:10px;
color:var(--green);letter-spacing:1px;display:none;max-width:280px;text-align:center}
#saveInfo.show{display:block}

#credits{position:absolute;bottom:14px;font-size:10px;color:#1e1e2e;letter-spacing:2px}

/* Year Complete */
#yearComp{z-index:450}
.yc-title{font-family:var(--display);font-size:clamp(2rem,7vw,4rem);
color:var(--green);letter-spacing:2px;text-align:center;
text-shadow:0 0 25px rgba(46,204,113,.6);margin-bottom:14px}
.yc-text{font-family:var(--mono);font-size:14px;color:#aaa;letter-spacing:1.5px;
text-align:center;max-width:90%;line-height:1.6;margin-bottom:28px}
.yc-btn{background:linear-gradient(135deg,rgba(12,12,22,0.92),rgba(20,20,35,0.92));
border:1px solid #2a4a2a;color:var(--green);
padding:15px 48px;font-family:var(--mono);font-size:.9rem;letter-spacing:2.5px;
border-radius:6px;cursor:pointer;transition:all .3s;text-transform:uppercase;
box-shadow:0 0 25px rgba(46,204,113,.3);width:85%}
.yc-btn:hover{background:#0e1e0e;border-color:var(--green);color:#fff;transform:scale(1.04)}

/* Certificate */
#certScreen{z-index:500;background:linear-gradient(135deg,#10101e,#07070f)}
.cert-wrap{background:#f5f0e8;border:6px solid #c0a020;border-radius:8px;
width:min(780px,95%);padding:30px 35px;text-align:center;
box-shadow:0 0 60px rgba(0,229,255,.4);position:relative;overflow:hidden}
.cert-border{position:absolute;inset:10px;border:2px solid #c0a020;border-radius:4px;pointer-events:none}
.cert-corner{position:absolute;width:40px;height:40px;border-color:#c0a020;border-style:solid}
.cert-corner.tl{top:14px;left:14px;border-width:2px 0 0 2px}
.cert-corner.tr{top:14px;right:14px;border-width:2px 2px 0 0}
.cert-corner.bl{bottom:14px;left:14px;border-width:0 0 2px 2px}
.cert-corner.br{bottom:14px;right:14px;border-width:0 2px 2px 0}
.cert-logo{font-size:44px;margin-bottom:4px}
.cert-school{font-family:var(--display);font-size:1.3rem;color:#1a3a5a;letter-spacing:3px;margin-bottom:6px}
.cert-presents{font-family:var(--mono);font-size:10px;color:#666;letter-spacing:2.5px;margin-bottom:4px}
.cert-name-area{border-bottom:2px solid #c0a020;border-top:2px solid #c0a020;
padding:10px 0;margin:12px 0;background:rgba(192,160,32,0.05)}
#certName{font-family:var(--display);font-size:1.9rem;color:#1a3a5a;letter-spacing:2.5px}
.cert-title-line{font-family:var(--display);font-size:1.3rem;color:#1a6a3a;letter-spacing:2.5px;margin:6px 0}
.cert-body{font-family:var(--mono);font-size:10px;color:#444;line-height:1.6;
margin:14px auto;max-width:520px;letter-spacing:.5px;padding:10px;
background:rgba(192,160,32,0.08);border-radius:4px}
.cert-date{font-family:var(--mono);font-size:10px;color:#666;letter-spacing:1.5px;margin-top:14px}
.cert-sigs{display:flex;flex-direction:column;gap:12px;margin-top:14px;padding-top:10px}
.cert-sig{text-align:center}
.cert-sig-line{border-bottom:1px solid #999;width:140px;margin:0 auto 4px}
.cert-sig-title{font-family:var(--mono);font-size:9px;color:#666;letter-spacing:1px}
.cert-btns{display:flex;flex-direction:column;gap:10px;margin-top:22px;justify-content:center}
.c-btn{background:linear-gradient(135deg,rgba(12,12,22,0.92),rgba(20,20,35,0.92));
border:1px solid #2a2a4a;color:var(--cyan);
padding:11px 28px;font-family:var(--mono);font-size:.75rem;letter-spacing:2px;
border-radius:6px;cursor:pointer;transition:all .2s;text-transform:uppercase}
.c-btn:hover{background:#14142a;border-color:var(--cyan);color:#fff;transform:translateY(-3px)}
.c-btn.dl{background:linear-gradient(135deg,var(--green),#27ae60);border-color:var(--green);color:#fff}
.c-btn.dl:hover{background:#27ae60;border-color:#27ae60}

/* Achievement Popup */
.achievement-popup{position:fixed;top:80px;right:8px;background:linear-gradient(135deg,#1a1a2e,#0f0f1e);
border:1px solid var(--gold);border-radius:8px;padding:11px 14px;
z-index:600;display:none;box-shadow:0 0 30px rgba(240,192,64,0.3)}
.achievement-popup.show{display:block}
.ach-icon{font-size:22px;margin-right:8px;vertical-align:middle}
.ach-text{display:inline-block;vertical-align:middle}
.ach-title{color:var(--gold);font-size:10px;letter-spacing:1px;margin-bottom:2px}
.ach-desc{color:#aaa;font-size:10px}

/* Touch Controls */
#touchOverlay{position:absolute;top:0;left:0;width:100%;height:100%;
background:transparent;pointer-events:auto;z-index:150;touch-action:none}
.touch-zone{position:absolute;width:50%;height:100%}
#touchLeft{left:0}
#touchRight{right:0}
.touch-indicator{position:absolute;width:70px;height:70px;
border:2px dashed rgba(52,152,219,0.5);border-radius:50%;
background:rgba(52,152,219,0.12);
display:flex;align-items:center;justify-content:center;
color:rgba(52,152,219,0.8);font-size:26px;font-weight:bold;
opacity:0;transition:opacity 0.15s;pointer-events:none;
box-shadow:0 0 25px rgba(52,152,219,0.3);font-family:var(--display)}
#indicatorUp{top:20%;left:50%;transform:translate(-50%,-50%)}
#indicatorDown{bottom:20%;left:50%;transform:translate(-50%,50%)}
#indicatorLeft{top:50%;left:20%;transform:translate(-50%,-50%)}
#indicatorRight{top:50%;right:20%;transform:translate(50%,-50%)}

#touchHint{position:absolute;bottom:80px;left:50%;transform:translateX(-50%);
background:rgba(52,152,219,0.15);border:1px solid rgba(52,152,219,0.4);
padding:8px 16px;border-radius:20px;font-size:11px;color:rgba(0,229,255,0.8);
z-index:160;pointer-events:none;opacity:0;transition:opacity 0.3s}
#touchHint.show{opacity:1}

/* Scanlines */
#scanlines{position:absolute;top:0;left:0;width:100%;height:100%;
background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.055) 2px,rgba(0,0,0,.055) 4px);
pointer-events:none;z-index:600}

/* Animations */
@keyframes pulse{0%,100%{opacity:.85}50%{opacity:1}}
@keyframes glow{
0%,100%{text-shadow:0 0 25px rgba(0,229,255,.45),0 0 50px rgba(0,229,255,.2)}
50%{text-shadow:0 0 40px rgba(0,229,255,.7),0 0 80px rgba(0,229,255,.35)}
}
@keyframes dotPulse{0%,100%{box-shadow:0 0 8px var(--green)}50%{box-shadow:0 0 15px var(--green)}}
@keyframes streakGlow{0%,100%{box-shadow:0 0 10px var(--orange)}50%{box-shadow:0 0 20px var(--orange)}}
@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes correctPulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
@keyframes achievementSlide{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}

@media(max-width:480px){
#mainTitle{font-size:clamp(2.2rem,14vw,4.5rem)}
.q-box{padding:20px}
.q-title{font-size:1.3rem}
.q-text{font-size:13px}
.q-btn{padding:10px 14px;font-size:12px}
#playerNameInput{width:180px;font-size:12px}
.touch-indicator{width:60px;height:60px;font-size:22px}
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
<div id="hYear" class="hud">YEAR: <span id="vYear">1</span>/7</div>
<div id="hLevel" class="hud">LEVEL: <span id="vLevel">1</span>/7</div>
<div id="hScore" class="hud">SCORE: <span id="vScore">0</span></div>
<div id="hStreak" class="hud">üî• <span id="vStreak">0</span></div>
<div id="saveIndicator">üíæ SAVED</div>
<div class="prog-wrap"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
<div class="q-dots" id="qDots">
<div class="q-dot" id="d0"></div>
<div class="q-dot" id="d1"></div>
<div class="q-dot" id="d2"></div>
</div>
<div id="narrator"></div>
<button id="pauseBtn">‚ùô‚ùô</button>

<!-- Pause Menu -->
<div class="overlay" id="pauseMenu">
<h2 id="pTitle">PAUSED</h2>
<div class="save-info">
<div class="save-info-label">PLAYER</div>
<div class="save-info-value" id="pausePlayerName">-</div>
<div class="save-info-label" style="margin-top:8px">PROGRESS</div>
<div class="save-info-value">Year <span id="pauseYear">1</span> ¬∑ Level <span id="pauseLevel">1</span></div>
<div class="save-info-label" style="margin-top:8px">SCORE</div>
<div class="save-info-value" id="pauseScore">0</div>
</div>
<button class="menu-btn" id="resumeBtn">RESUME</button>
<button class="menu-btn" id="rstBtn">RESTART LEVEL</button>
<button class="menu-btn danger" id="quitBtn">QUIT TO MENU</button>
</div>

<!-- Question Panel -->
<div class="overlay" id="qPanel">
<div class="q-box">
<div class="q-title" id="qTitle">MEDICAL QUESTION</div>
<div style="text-align:center"><span class="q-year-badge" id="qBadge">YEAR 1 ‚Äî ANATOMY</span></div>
<div class="q-text" id="qText"></div>
<div class="q-opts" id="qOpts"></div>
<div class="q-feedback" id="qFb"></div>
<div class="q-explanation" id="qExplanation"></div>
<button id="skipBtn">SKIP (10s)</button>
<div class="skip-bar-wrap"><div class="skip-bar" id="skipBar" style="width:100%"></div></div>
</div>
</div>

<!-- Year Complete -->
<div class="overlay" id="yearComp">
<div class="yc-title" id="ycTitle">YEAR 1 COMPLETE!</div>
<div class="yc-text" id="ycText"></div>
<button class="yc-btn" id="nextYrBtn">CONTINUE</button>
</div>

<!-- Certificate -->
<div class="overlay" id="certScreen">
<div class="cert-wrap">
<div class="cert-border"></div>
<div class="cert-corner tl"></div><div class="cert-corner tr"></div>
<div class="cert-corner bl"></div><div class="cert-corner br"></div>
<div class="cert-logo">‚öïÔ∏è</div>
<div class="cert-school" id="certSchool">DOCTOR QUEST MEDICAL SCHOOL</div>
<div class="cert-presents" id="certPresents">THIS CERTIFIES THAT</div>
<div class="cert-name-area"><div id="certName">DR. [NAME]</div></div>
<div class="cert-title-line" id="certTL">IS OFFICIALLY A DOCTOR OF MEDICINE</div>
<div class="cert-body" id="certBody">Having successfully completed seven years of rigorous medical education.</div>
<div class="cert-date" id="certDate"></div>
<div class="cert-sigs">
<div class="cert-sig"><div class="cert-sig-line"></div><div class="cert-sig-title" id="sigDean">DEAN OF MEDICINE</div></div>
<div class="cert-sig"><div class="cert-sig-line"></div><div class="cert-sig-title" id="sigReg">MEDICAL REGISTRAR</div></div>
</div>
<div class="cert-btns">
<button class="c-btn dl" id="dlBtn">üíæ SAVE CERTIFICATE</button>
<button class="c-btn" id="playAgainBtn">üîÑ PLAY AGAIN</button>
</div>
</div>
</div>

<!-- Achievement Popup -->
<div class="achievement-popup" id="achPopup">
<span class="ach-icon">üèÜ</span>
<div class="ach-text">
<div class="ach-title">ACHIEVEMENT UNLOCKED!</div>
<div class="ach-desc" id="achDesc">First Steps</div>
</div>
</div>

<!-- Touch Controls -->
<div id="touchOverlay">
<div class="touch-zone" id="touchLeft">
<div class="touch-indicator" id="indicatorUp">‚Üë</div>
<div class="touch-indicator" id="indicatorDown">‚Üì</div>
<div class="touch-indicator" id="indicatorLeft">‚Üê</div>
</div>
<div class="touch-zone" id="touchRight">
<div class="touch-indicator" id="indicatorRight">‚Üí</div>
</div>
</div>
<div id="touchHint">üëÜ SWIPE TO MOVE</div>
</div>

<!-- Title Screen -->
<div id="title">
<div class="t-pre" id="tPre">MEDICAL SCHOOL SIMULATION</div>
<h1 id="mainTitle">DOCTOR QUEST</h1>
<div class="t-sub" id="tSub">7 YEARS ¬∑ 7 LEVELS ¬∑ 3 QUESTIONS EACH</div>

<!-- Player Name Input -->
<div class="name-input-wrap">
<label for="playerNameInput">ENTER YOUR NAME</label>
<input type="text" id="playerNameInput" placeholder="DR. YOUR NAME" maxlength="20">
</div>

<div class="t-btns">
<button class="t-btn primary" id="startBtn">üéì BEGIN MEDICAL SCHOOL</button>
<button class="t-btn continue" id="continueBtn" style="display:none">üìÇ CONTINUE PROGRESS</button>
<button class="t-btn lang" id="langBtn">üåê LANGUAGE: ENGLISH</button>
<button class="t-btn" id="howBtn">‚ùì HOW TO PLAY</button>
</div>

<!-- Save Info Display -->
<div id="saveInfo"></div>

<div id="credits">üéì GRADUATES: <span id="gradCount">0</span></div>
</div>
<div id="scanlines"></div>

<script>
// ============================================================
// MEDICAL QUESTION DATABASE (Years 1-7 with explanations)
// ============================================================
const DB = {
year1:{
label:{en:"YEAR 1 ‚Äî ANATOMY & PHYSIOLOGY",fr:"ANN√âE 1 ‚Äî ANATOMIE & PHYSIOLOGIE"},
qs:[
{en:"What is the largest organ in the human body?",fr:"Quel est le plus grand organe du corps humain ?",a:{en:["Skin","Liver","Heart","Lung"],fr:["Peau","Foie","C≈ìur","Poumon"]},ca:0,exp:{en:"The skin covers approximately 20 square feet in adults.",fr:"La peau couvre environ 2 m√®tres carr√©s chez l'adulte."}},
{en:"How many bones are in the adult human body?",fr:"Combien d'os y a-t-il dans le corps humain adulte ?",a:{en:["206","300","172","250"],fr:["206","300","172","250"]},ca:0,exp:{en:"Adults have 206 bones. Babies are born with ~270 that fuse together.",fr:"Les adultes ont 206 os. Les b√©b√©s naissent avec ~270 qui fusionnent."}},
{en:"Which blood type is the universal donor?",fr:"Quel groupe sanguin est le donneur universel ?",a:{en:["O-","A+","B-","AB+"],fr:["O-","A+","B-","AB+"]},ca:0,exp:{en:"O- blood lacks A, B, and Rh antigens, safe for all recipients.",fr:"Le sang O- n'a pas d'antig√®nes A, B et Rh, s√ªr pour tous."}},
{en:"What is the normal resting heart rate for adults?",fr:"Quelle est la fr√©quence cardiaque normale au repos ?",a:{en:["60-100 bpm","40-60 bpm","110-130 bpm","80-150 bpm"],fr:["60-100 bpm","40-60 bpm","110-130 bpm","80-150 bpm"]},ca:0,exp:{en:"Normal resting heart rate is 60-100 beats per minute.",fr:"La fr√©quence normale au repos est 60-100 bpm."}},
{en:"Which organ produces insulin?",fr:"Quel organe produit l'insuline ?",a:{en:["Pancreas","Liver","Kidney","Spleen"],fr:["Pancr√©as","Foie","Rein","Rate"]},ca:0,exp:{en:"Insulin is produced by beta cells in the Islets of Langerhans.",fr:"L'insuline est produite par les cellules b√™ta des √Ælots de Langerhans."}},
{en:"What is the longest bone in the human body?",fr:"Quel est l'os le plus long du corps humain ?",a:{en:["Femur","Tibia","Fibula","Humerus"],fr:["F√©mur","Tibia","Fibula","Hum√©rus"]},ca:0,exp:{en:"The femur is the longest and strongest bone in the body.",fr:"Le f√©mur est l'os le plus long et le plus solide."}},
{en:"How many chambers does the human heart have?",fr:"Combien de cavit√©s a le c≈ìur humain ?",a:{en:["4","2","3","6"],fr:["4","2","3","6"]},ca:0,exp:{en:"The heart has 4 chambers: 2 atria and 2 ventricles.",fr:"Le c≈ìur a 4 cavit√©s : 2 oreillettes et 2 ventricules."}},
{en:"What is the functional unit of the kidney?",fr:"Quelle est l'unit√© fonctionnelle du rein ?",a:{en:["Nephron","Neuron","Alveolus","Hepatocyte"],fr:["N√©phron","Neurone","Alv√©ole","H√©patocyte"]},ca:0,exp:{en:"Each kidney contains about 1 million nephrons.",fr:"Chaque rein contient environ 1 million de n√©phrons."}},
{en:"Which gas do red blood cells primarily carry?",fr:"Quel gaz les globules rouges transportent-ils principalement ?",a:{en:["Oxygen","Carbon dioxide","Nitrogen","Argon"],fr:["Oxyg√®ne","Dioxyde de carbone","Azote","Argon"]},ca:0,exp:{en:"RBCs carry oxygen from lungs to tissues via hemoglobin.",fr:"Les GR transportent l'oxyg√®ne des poumons aux tissus."}},
{en:"What is the membrane surrounding the heart called?",fr:"Quel est le terme pour la membrane entourant le c≈ìur ?",a:{en:["Pericardium","Pleura","Peritoneum","Dura mater"],fr:["P√©ricarde","Pl√®vre","P√©ritoine","Dure-m√®re"]},ca:0,exp:{en:"The pericardium is a double-walled sac protecting the heart.",fr:"Le p√©ricarde est un sac √† double paroi prot√©geant le c≈ìur."}},
{en:"What protein carries oxygen in red blood cells?",fr:"Quelle prot√©ine transporte l'oxyg√®ne dans les globules rouges ?",a:{en:["Hemoglobin","Albumin","Fibrinogen","Myosin"],fr:["H√©moglobine","Albumine","Fibrinog√®ne","Myosine"]},ca:0,exp:{en:"Hemoglobin binds oxygen and gives blood its red color.",fr:"L'h√©moglobine lie l'oxyg√®ne et donne sa couleur rouge."}},
{en:"Which part of the brain controls breathing?",fr:"Quelle partie du cerveau contr√¥le la respiration ?",a:{en:["Medulla oblongata","Cerebellum","Cerebrum","Thalamus"],fr:["Bulbe rachidien","Cervelet","Cerveau","Thalamus"]},ca:0,exp:{en:"The medulla oblongata controls automatic functions like breathing.",fr:"Le bulbe rachidien contr√¥le les fonctions automatiques."}},
{en:"How many pairs of cranial nerves exist?",fr:"Combien de paires de nerfs cr√¢niens existent-ils ?",a:{en:["12","10","8","14"],fr:["12","10","8","14"]},ca:0,exp:{en:"There are 12 pairs of cranial nerves emerging from the brain.",fr:"Il y a 12 paires de nerfs cr√¢niens."}},
{en:"What connects muscle to bone?",fr:"Quelle structure relie le muscle √† l'os ?",a:{en:["Tendon","Ligament","Cartilage","Fascia"],fr:["Tendon","Ligament","Cartilage","Fascia"]},ca:0,exp:{en:"Tendons connect muscle to bone. Ligaments connect bone to bone.",fr:"Les tendons relient muscle √† os. Les ligaments relient os √† os."}},
{en:"What fluid surrounds the brain and spinal cord?",fr:"Quel liquide entoure le cerveau et la moelle √©pini√®re ?",a:{en:["Cerebrospinal fluid","Lymph","Synovial fluid","Aqueous humor"],fr:["Liquide c√©phalorachidien","Lymphe","Liquide synovial","Humeur aqueuse"]},ca:0,exp:{en:"CSF cushions the CNS and removes waste.",fr:"Le LCR prot√®ge le SNC et √©limine les d√©chets."}},
{en:"Which organ produces bile?",fr:"Quel organe produit la bile ?",a:{en:["Liver","Gallbladder","Pancreas","Duodenum"],fr:["Foie","V√©sicule biliaire","Pancr√©as","Duod√©num"]},ca:0,exp:{en:"The liver produces bile; the gallbladder stores it.",fr:"Le foie produit la bile ; la v√©sicule la stocke."}},
{en:"How many lobes does the right lung have?",fr:"Combien de lobes le poumon droit a-t-il ?",a:{en:["3","2","4","1"],fr:["3","2","4","1"]},ca:0,exp:{en:"Right lung has 3 lobes; left lung has 2 (space for heart).",fr:"Le poumon droit a 3 lobes ; le gauche en a 2."}},
{en:"What is the normal adult respiratory rate?",fr:"Quelle est la fr√©quence respiratoire normale d'un adulte ?",a:{en:["12-20 per min","5-10 per min","25-35 per min","40-50 per min"],fr:["12-20 par min","5-10 par min","25-35 par min","40-50 par min"]},ca:0,exp:{en:"Normal respiratory rate is 12-20 breaths per minute at rest.",fr:"La fr√©quence normale est 12-20 respirations par minute."}},
{en:"Which vitamin is produced by skin under sunlight?",fr:"Quelle vitamine est produite par la peau sous le soleil ?",a:{en:["Vitamin D","Vitamin C","Vitamin A","Vitamin K"],fr:["Vitamine D","Vitamine C","Vitamine A","Vitamine K"]},ca:0,exp:{en:"UV rays convert 7-dehydrocholesterol to Vitamin D3.",fr:"Les UV convertissent en vitamine D3."}},
{en:"What is the smallest unit of life?",fr:"Quelle est la plus petite unit√© de vie ?",a:{en:["Cell","Organ","Tissue","Molecule"],fr:["Cellule","Organe","Tissu","Mol√©cule"]},ca:0,exp:{en:"The cell is the basic structural and functional unit of life.",fr:"La cellule est l'unit√© de base de la vie."}}
]
},
year2:{label:{en:"YEAR 2 ‚Äî BIOCHEMISTRY & HISTOLOGY",fr:"ANN√âE 2 ‚Äî BIOCHIMIE & HISTOLOGIE"},qs:[
{en:"What is the powerhouse of the cell?",fr:"Quel est le moteur de la cellule ?",a:{en:["Mitochondria","Nucleus","Ribosome","Golgi apparatus"],fr:["Mitochondries","Noyau","Ribosome","Appareil de Golgi"]},ca:0,exp:{en:"Mitochondria produce ATP through cellular respiration.",fr:"Les mitochondries produisent l'ATP."}},
{en:"Which macromolecule carries genetic information?",fr:"Quelle macromol√©cule porte l'information g√©n√©tique ?",a:{en:["DNA","RNA","Protein","Lipid"],fr:["ADN","ARN","Prot√©ine","Lipide"]},ca:0,exp:{en:"DNA stores genetic information in the nucleus.",fr:"L'ADN stocke l'information g√©n√©tique."}},
{en:"What is the first step of glycolysis?",fr:"Quelle est la premi√®re √©tape de la glycolyse ?",a:{en:["Glucose ‚Üí Glucose-6-phosphate","Pyruvate ‚Üí Acetyl-CoA","Fructose-6-P ‚Üí Fructose-1,6-P","G3P ‚Üí 1,3-BPG"],fr:["Glucose ‚Üí Glucose-6-phosphate","Pyruvate ‚Üí Ac√©tyl-CoA","Fructose-6-P ‚Üí Fructose-1,6-P","G3P ‚Üí 1,3-BPG"]},ca:0,exp:{en:"Hexokinase phosphorylates glucose.",fr:"L'hexokinase phosphoryle le glucose."}},
{en:"Which enzyme converts glucose in the liver?",fr:"Quelle enzyme convertit le glucose dans le foie ?",a:{en:["Glucokinase","Hexokinase","Phosphofructokinase","Aldolase"],fr:["Glucokinase","Hexokinase","Phosphofructokinase","Aldolase"]},ca:0,exp:{en:"Glucokinase is liver-specific.",fr:"La glucokinase est sp√©cifique au foie."}},
{en:"What is the end product of the Krebs cycle?",fr:"Quel est le produit final du cycle de Krebs ?",a:{en:["CO2, NADH, FADH2","Glucose","Pyruvate","Lactate"],fr:["CO2, NADH, FADH2","Glucose","Pyruvate","Lactate"]},ca:0,exp:{en:"Krebs produces CO2, NADH, FADH2 for ETC.",fr:"Le cycle de Krebs produit CO2, NADH, FADH2."}},
{en:"Which cells line the alveoli?",fr:"Quelles cellules tapissent les alv√©oles ?",a:{en:["Type I & II pneumocytes","Hepatocytes","Enterocytes","Keratinocytes"],fr:["Pneumocytes de type I & II","H√©patocytes","Ent√©rocytes","K√©ratinocytes"]},ca:0,exp:{en:"Type I for gas exchange, Type II produce surfactant.",fr:"Type I pour √©changes, Type II produisent surfactant."}},
{en:"What enzyme unwinds DNA for replication?",fr:"Quelle enzyme d√©roule l'ADN pour la r√©plication ?",a:{en:["Helicase","Polymerase","Ligase","Topoisomerase"],fr:["H√©licase","Polym√©rase","Ligase","Topoisom√©rase"]},ca:0,exp:{en:"Helicase unwinds DNA at replication forks.",fr:"L'h√©licase d√©roule l'ADN."}},
{en:"Which collagen type is most abundant in skin?",fr:"Quel type de collag√®ne est le plus abondant dans la peau ?",a:{en:["Type I","Type II","Type III","Type IV"],fr:["Type I","Type II","Type III","Type IV"]},ca:0,exp:{en:"Type I collagen makes up 90% of skin.",fr:"Le collag√®ne type I repr√©sente 90%."}},
{en:"What is the main intracellular cation?",fr:"Quel est le principal cation intracellulaire ?",a:{en:["Potassium (K+)","Sodium (Na+)","Calcium (Ca2+)","Magnesium (Mg2+)"],fr:["Potassium (K+)","Sodium (Na+)","Calcium (Ca2+)","Magn√©sium (Mg2+)"]},ca:0,exp:{en:"K+ is high inside; Na+ is high outside.",fr:"K+ est √©lev√© dedans ; Na+ dehors."}},
{en:"Which cells produce antibodies?",fr:"Quelles cellules produisent des anticorps ?",a:{en:["Plasma cells","T lymphocytes","NK cells","Macrophages"],fr:["Plasmocytes","Lymphocytes T","Cellules NK","Macrophages"]},ca:0,exp:{en:"Plasma cells are differentiated B cells.",fr:"Les plasmocytes sont des lymphocytes B diff√©renci√©s."}},
{en:"What tissue type forms glands?",fr:"Quel type de tissu forme les glandes ?",a:{en:["Epithelial","Connective","Muscle","Nervous"],fr:["√âpith√©lial","Conjonctif","Musculaire","Nerveux"]},ca:0,exp:{en:"Epithelial tissue forms glands.",fr:"Le tissu √©pith√©lial forme les glandes."}},
{en:"What is the role of smooth ER?",fr:"Quel est le r√¥le du r√©ticulum endoplasmique lisse ?",a:{en:["Lipid synthesis","Protein synthesis","DNA replication","Mitosis"],fr:["Synth√®se des lipides","Synth√®se des prot√©ines","R√©plication de l'ADN","Mitose"]},ca:0,exp:{en:"Smooth ER synthesizes lipids and detoxifies.",fr:"Le REL synth√©tise les lipides."}},
{en:"Which organelle packages proteins?",fr:"Quel organite emballe les prot√©ines ?",a:{en:["Golgi apparatus","Ribosome","Mitochondria","Lysosome"],fr:["Appareil de Golgi","Ribosome","Mitochondries","Lysosome"]},ca:0,exp:{en:"Golgi modifies and packages proteins.",fr:"L'appareil de Golgi emballe les prot√©ines."}},
{en:"What is the building block of proteins?",fr:"Quel est le composant de base des prot√©ines ?",a:{en:["Amino acids","Nucleotides","Fatty acids","Monosaccharides"],fr:["Acides amin√©s","Nucl√©otides","Acides gras","Monosaccharides"]},ca:0,exp:{en:"20 amino acids form all proteins.",fr:"20 acides amin√©s forment toutes les prot√©ines."}},
{en:"Which bond holds DNA double helix?",fr:"Quel type de liaison maintient la double h√©lice de l'ADN ?",a:{en:["Hydrogen bonds","Covalent bonds","Ionic bonds","Van der Waals"],fr:["Liaisons hydrog√®ne","Liaisons covalentes","Liaisons ioniques","Forces de Van der Waals"]},ca:0,exp:{en:"Hydrogen bonds between base pairs.",fr:"Liaisons H entre paires de bases."}},
{en:"How many ATP from glucose oxidation?",fr:"Combien d'ATP de l'oxydation du glucose ?",a:{en:["30-32 ATP","2 ATP","8 ATP","50 ATP"],fr:["30-32 ATP","2 ATP","8 ATP","50 ATP"]},ca:0,exp:{en:"Complete oxidation yields 30-32 ATP.",fr:"L'oxydation compl√®te produit 30-32 ATP."}},
{en:"What is albumin's primary role?",fr:"Quel est le r√¥le principal de l'albumine ?",a:{en:["Maintain oncotic pressure","Carry oxygen","Clotting factor","Fight infection"],fr:["Maintenir la pression oncotique","Transporter l'oxyg√®ne","Facteur de coagulation","Lutter contre l'infection"]},ca:0,exp:{en:"Albumin maintains blood oncotic pressure.",fr:"L'albumine maintient la pression oncotique."}},
{en:"Which cells are CNS phagocytes?",fr:"Quelles cellules sont les phagocytes du SNC ?",a:{en:["Microglia","Astrocytes","Oligodendrocytes","Schwann cells"],fr:["Microglie","Astrocytes","Oligodendrocytes","Cellules de Schwann"]},ca:0,exp:{en:"Microglia are resident macrophages of CNS.",fr:"La microglie sont les macrophages du SNC."}},
{en:"What process do cells use to eat particles?",fr:"Quel processus les cellules utilisent pour ing√©rer ?",a:{en:["Phagocytosis","Pinocytosis","Exocytosis","Endocytosis"],fr:["Phagocytose","Pinocytose","Exocytose","Endocytose"]},ca:0,exp:{en:"Phagocytosis engulfs large particles.",fr:"La phagocytose ing√®re de grandes particules."}},
{en:"Which skin layer contains melanocytes?",fr:"Quelle couche de peau contient les m√©lanocytes ?",a:{en:["Stratum basale","Stratum corneum","Stratum granulosum","Stratum spinosum"],fr:["Stratum basale","Stratum corneum","Stratum granulosum","Stratum spinosum"]},ca:0,exp:{en:"Melanocytes produce melanin in stratum basale.",fr:"Les m√©lanocytes produisent la m√©lanine."}}
]},
year3:{label:{en:"YEAR 3 ‚Äî PATHOLOGY & MICROBIOLOGY",fr:"ANN√âE 3 ‚Äî PATHOLOGIE & MICROBIOLOGIE"},qs:[
{en:"What causes community-acquired pneumonia?",fr:"Quelle est la cause de la pneumonie communautaire ?",a:{en:["Streptococcus pneumoniae","E. coli","Staphylococcus aureus","Klebsiella"],fr:["Streptocoque pneumoniae","E. coli","Staphylocoque dor√©","Klebsiella"]},ca:0,exp:{en:"S. pneumoniae is the most common cause of CAP.",fr:"S. pneumoniae est la cause la plus fr√©quente."}},
{en:"Which bacterium causes tuberculosis?",fr:"Quelle bact√©rie cause la tuberculose ?",a:{en:["Mycobacterium tuberculosis","Streptococcus","E. coli","Salmonella"],fr:["Mycobacterium tuberculosis","Streptocoque","E. coli","Salmonelle"]},ca:0,exp:{en:"M. tuberculosis is an acid-fast bacillus.",fr:"M. tuberculosis est un bacille acido-alcoolo-r√©sistant."}},
{en:"What cell marks chronic inflammation?",fr:"Quelle cellule marque l'inflammation chronique ?",a:{en:["Macrophage","Neutrophil","Eosinophil","Basophil"],fr:["Macrophage","Neutrophile","√âosinophile","Basophile"]},ca:0,exp:{en:"Macrophages dominate chronic inflammation.",fr:"Les macrophages dominent l'inflammation chronique."}},
{en:"Which virus causes AIDS?",fr:"Quel virus cause le SIDA ?",a:{en:["HIV","HPV","HBV","HSV"],fr:["VIH","VPH","VHB","VHS"]},ca:0,exp:{en:"HIV destroys CD4+ T cells.",fr:"Le VIH d√©truit les lymphocytes T CD4+."}},
{en:"What necrosis occurs in MI?",fr:"Quelle n√©crose survient dans l'infarctus ?",a:{en:["Coagulative","Liquefactive","Caseous","Fat"],fr:["Coagulante","Liqu√©fiante","Cas√©euse","Graisseuse"]},ca:0,exp:{en:"Coagulative necrosis is typical of ischemic injury.",fr:"La n√©crose coagulante est typique de l'isch√©mie."}},
{en:"Which organism causes malaria?",fr:"Quel organisme cause le paludisme ?",a:{en:["Plasmodium","Trypanosoma","Leishmania","Giardia"],fr:["Plasmodium","Trypanosoma","Leishmania","Giardia"]},ca:0,exp:{en:"Plasmodium is transmitted by Anopheles mosquitoes.",fr:"Plasmodium est transmis par les moustiques."}},
{en:"What is the most common skin cancer?",fr:"Quel est le cancer de la peau le plus courant ?",a:{en:["Basal cell carcinoma","Melanoma","Squamous cell","Merkel cell"],fr:["Carcinome basocellulaire","M√©lanome","Carcinome √©pidermo√Øde","Cellule de Merkel"]},ca:0,exp:{en:"BCC is most common but least likely to metastasize.",fr:"Le CBC est le plus courant."}},
{en:"Which antibody is produced first?",fr:"Quel anticorps est produit en premier ?",a:{en:["IgM","IgG","IgA","IgE"],fr:["IgM","IgG","IgA","IgE"]},ca:0,exp:{en:"IgM is first in primary immune response.",fr:"L'IgM est le premier de la r√©ponse primaire."}},
{en:"What is cancer spread called?",fr:"Comment appelle-t-on la propagation du cancer ?",a:{en:["Metastasis","Invasion","Hyperplasia","Dysplasia"],fr:["M√©tastase","Invasion","Hyperplasie","Dysplasie"]},ca:0,exp:{en:"Metastasis is spread via blood/lymph.",fr:"La m√©tastase est la propagation √† distance."}},
{en:"Which bacteria is gram-positive?",fr:"Quelle bact√©rie est gram-positive ?",a:{en:["Staphylococcus","E. coli","Salmonella","Pseudomonas"],fr:["Staphylocoque","E. coli","Salmonelle","Pseudomonas"]},ca:0,exp:{en:"Staphylococcus retains crystal violet.",fr:"Staphylococcus retient le cristal violet."}},
{en:"What is HIV's primary target?",fr:"Quelle est la cible principale du VIH ?",a:{en:["CD4+ T cells","B cells","Neutrophils","RBCs"],fr:["Lymphocytes T CD4+","Lymphocytes B","Neutrophiles","GR"]},ca:0,exp:{en:"HIV binds to CD4 receptor on helper T cells.",fr:"Le VIH se lie au r√©cepteur CD4."}},
{en:"What type is anaphylaxis?",fr:"Quel type d'hypersensibilit√© est l'anaphylaxie ?",a:{en:["Type I","Type II","Type III","Type IV"],fr:["Type I","Type II","Type III","Type IV"]},ca:0,exp:{en:"Type I is IgE-mediated immediate hypersensitivity.",fr:"Le type I est l'hypersensibilit√© imm√©diate."}},
{en:"What causes syphilis?",fr:"Quel organisme cause la syphilis ?",a:{en:["Treponema pallidum","Neisseria","Chlamydia","Gonorrhea"],fr:["Treponema pallidum","Neisseria","Chlamydia","Gonorrh√©e"]},ca:0,exp:{en:"T. pallidum is a spirochete bacterium.",fr:"T. pallidum est une bact√©rie spiroch√®te."}},
{en:"Which cell rises in bacterial infection?",fr:"Quelle cellule augmente dans l'infection bact√©rienne ?",a:{en:["Neutrophils","Lymphocytes","Eosinophils","Monocytes"],fr:["Neutrophiles","Lymphocytes","√âosinophiles","Monocytes"]},ca:0,exp:{en:"Neutrophilia indicates acute bacterial infection.",fr:"La neutrophilie indique une infection bact√©rienne."}},
{en:"What causes most UTIs?",fr:"Quelle est la cause des infections urinaires ?",a:{en:["E. coli","Staphylococcus","Streptococcus","Klebsiella"],fr:["E. coli","Staphylocoque","Streptocoque","Klebsiella"]},ca:0,exp:{en:"E. coli from GI tract causes 80%+ of UTIs.",fr:"E. coli cause 80%+ des IU."}},
{en:"Which virus causes chickenpox?",fr:"Quel virus cause la varicelle ?",a:{en:["Varicella-zoster","Influenza","Measles","Mumps"],fr:["Varicelle-zona","Influenza","Rougeole","Oreillons"]},ca:0,exp:{en:"VZV causes chickenpox; can reactivate as shingles.",fr:"Le VZV cause la varicelle."}},
{en:"What is programmed cell death?",fr:"Qu'est-ce que la mort cellulaire programm√©e ?",a:{en:["Apoptosis","Necrosis","Autophagy","Senescence"],fr:["Apoptose","N√©crose","Autophagie","S√©nescence"]},ca:0,exp:{en:"Apoptosis is controlled cell death.",fr:"L'apoptose est une mort cellulaire contr√¥l√©e."}},
{en:"Which fungus causes thrush?",fr:"Quel champignon cause le muguet ?",a:{en:["Candida albicans","Aspergillus","Cryptococcus","Histoplasma"],fr:["Candida albicans","Aspergillus","Cryptococcus","Histoplasma"]},ca:0,exp:{en:"C. albicans is normal flora that can overgrow.",fr:"C. albicans est une flore normale."}},
{en:"What is rabies incubation?",fr:"Quelle est la p√©riode d'incubation de la rage ?",a:{en:["1-3 months","1-3 days","1-3 weeks","1-3 years"],fr:["1-3 mois","1-3 jours","1-3 semaines","1-3 ans"]},ca:0,exp:{en:"Rabies incubation is typically 1-3 months.",fr:"L'incubation de la rage est 1-3 mois."}},
{en:"What causes peptic ulcers?",fr:"Quelle bact√©rie cause les ulc√®res peptiques ?",a:{en:["Helicobacter pylori","E. coli","Salmonella","Shigella"],fr:["Helicobacter pylori","E. coli","Salmonelle","Shigella"]},ca:0,exp:{en:"H. pylori survives stomach acid.",fr:"H. pylori survit √† l'acide gastrique."}}
]},
year4:{label:{en:"YEAR 4 ‚Äî PHARMACOLOGY & DIAGNOSTICS",fr:"ANN√âE 4 ‚Äî PHARMACOLOGIE & DIAGNOSTIC"},qs:[
{en:"What is aspirin's mechanism?",fr:"Quel est le m√©canisme de l'aspirine ?",a:{en:["COX inhibitor","ACE inhibitor","Beta blocker","Calcium channel blocker"],fr:["Inhibiteur COX","Inhibiteur ACE","B√™ta-bloquant","Bloqueur calcique"]},ca:0,exp:{en:"Aspirin irreversibly inhibits COX-1 and COX-2.",fr:"L'aspirine inhibe COX-1 et COX-2."}},
{en:"What treats hypertension?",fr:"Quel m√©dicament traite l'hypertension ?",a:{en:["ACE inhibitors","Antibiotics","Antivirals","Antifungals"],fr:["Inhibiteurs ACE","Antibiotiques","Antiviraux","Antifongiques"]},ca:0,exp:{en:"ACE inhibitors reduce angiotensin II.",fr:"Les IEC r√©duisent l'angiotensine II."}},
{en:"What reverses warfarin?",fr:"Quel est l'antidote de la warfarine ?",a:{en:["Vitamin K","Protamine sulfate","Naloxone","Flumazenil"],fr:["Vitamine K","Sulfate de protamine","Naloxone","Flumaz√©nil"]},ca:0,exp:{en:"Vitamin K reverses warfarin's effect.",fr:"La vitamine K inverse la warfarine."}},
{en:"What treats anaphylaxis?",fr:"Quel m√©dicament traite l'anaphylaxie ?",a:{en:["Epinephrine","Insulin","Morphine","Atropine"],fr:["√âpin√©phrine","Insuline","Morphine","Atropine"]},ca:0,exp:{en:"IM epinephrine is first-line.",fr:"L'√©pin√©phrine IM est de premi√®re intention."}},
{en:"What is drug half-life?",fr:"Qu'est-ce que la demi-vie d'un m√©dicament ?",a:{en:["Time to reduce concentration by 50%","Time to reach peak effect","Time to eliminate completely","Time to start working"],fr:["Temps pour r√©duire la concentration de 50%","Temps pour atteindre l'effet maximal","Temps pour √©liminer compl√®tement","Temps pour commencer √† agir"]},ca:0,exp:{en:"Half-life determines dosing frequency.",fr:"La demi-vie d√©termine la fr√©quence."}},
{en:"What receptor does morphine act on?",fr:"Sur quel r√©cepteur la morphine agit-elle ?",a:{en:["Opioid receptor","Dopamine receptor","Serotonin receptor","GABA receptor"],fr:["R√©cepteur opio√Øde","R√©cepteur dopamine","R√©cepteur s√©rotonine","R√©cepteur GABA"]},ca:0,exp:{en:"Morphine is a mu-opioid agonist.",fr:"La morphine est un agoniste mu-opio√Øde."}},
{en:"First-line for Type 2 diabetes?",fr:"Traitement de premi√®re intention du diab√®te type 2 ?",a:{en:["Metformin","Insulin","Glipizide","Acarbose"],fr:["Metformine","Insuline","Glipizide","Acarbose"]},ca:0,exp:{en:"Metformin reduces hepatic glucose production.",fr:"La metformine r√©duit la production h√©patique."}},
{en:"Which drug is a beta-blocker?",fr:"Quel m√©dicament est un b√™ta-bloquant ?",a:{en:["Atenolol","Lisinopril","Amlodipine","Furosemide"],fr:["At√©nolol","Lisinopril","Amlodipine","Furos√©mide"]},ca:0,exp:{en:"Atenolol blocks beta-1 receptors.",fr:"L'at√©nolol bloque les r√©cepteurs b√™ta-1."}},
{en:"What is therapeutic index?",fr:"Qu'est-ce que l'indice th√©rapeutique ?",a:{en:["Ratio of toxic to therapeutic dose","Drug absorption rate","Drug elimination rate","Drug distribution volume"],fr:["Ratio dose toxique/th√©rapeutique","Taux d'absorption","Taux d'√©limination","Volume de distribution"]},ca:0,exp:{en:"Higher TI = safer drug.",fr:"Un IT √©lev√© = m√©dicament plus s√ªr."}},
{en:"Which inhibits cell wall synthesis?",fr:"Quel antibiotique inhibe la paroi cellulaire ?",a:{en:["Penicillin","Tetracycline","Erythromycin","Ciprofloxacin"],fr:["P√©nicilline","T√©tracycline","√ârythromycine","Ciprofloxacine"]},ca:0,exp:{en:"Penicillins inhibit peptidoglycan.",fr:"Les p√©nicillines inhibent le peptidoglycane."}},
{en:"What is bioavailability?",fr:"Qu'est-ce que la biodisponibilit√© ?",a:{en:["Fraction reaching systemic circulation","Drug potency","Drug efficacy","Drug toxicity"],fr:["Fraction atteignant la circulation","Puissance du m√©dicament","Efficacit√© du m√©dicament","Toxicit√© du m√©dicament"]},ca:0,exp:{en:"IV has 100% bioavailability.",fr:"L'IV a 100% de biodisponibilit√©."}},
{en:"What treats asthma?",fr:"Quel m√©dicament traite l'asthme ?",a:{en:["Albuterol","Digoxin","Warfarin","Metformin"],fr:["Albut√©rol","Digoxine","Warfarine","Metformine"]},ca:0,exp:{en:"Albuterol is a beta-2 agonist.",fr:"L'albut√©rol est un agoniste b√™ta-2."}},
{en:"What is statins' mechanism?",fr:"Quel est le m√©canisme des statines ?",a:{en:["HMG-CoA reductase inhibition","ACE inhibition","Beta blockade","Calcium channel blockade"],fr:["Inhibition HMG-CoA r√©ductase","Inhibition ACE","B√™ta-blocage","Blocage calcique"]},ca:0,exp:{en:"Statins reduce cholesterol synthesis.",fr:"Les statines r√©duisent le cholest√©rol."}},
{en:"What treats Parkinson's?",fr:"Quel m√©dicament traite la maladie de Parkinson ?",a:{en:["Levodopa","Insulin","Warfarin","Aspirin"],fr:["L√©vodopa","Insuline","Warfarine","Aspirine"]},ca:0,exp:{en:"Levodopa converts to dopamine.",fr:"La l√©vodopa se convertit en dopamine."}},
{en:"What is a prodrug?",fr:"Qu'est-ce qu'une prodrogue ?",a:{en:["Inactive form converted to active","Active drug form","Drug metabolite","Drug antagonist"],fr:["Forme inactive convertie en forme active","Forme active du m√©dicament","M√©tabolite du m√©dicament","Antagoniste du m√©dicament"]},ca:0,exp:{en:"Prodrugs require metabolism to activate.",fr:"Les prodrogues n√©cessitent un m√©tabolisme."}},
{en:"Which is an anticoagulant?",fr:"Quel m√©dicament est un anticoagulant ?",a:{en:["Heparin","Aspirin","Ibuprofen","Acetaminophen"],fr:["H√©parine","Aspirine","Ibuprof√®ne","Ac√©taminoph√®ne"]},ca:0,exp:{en:"Heparin enhances antithrombin III.",fr:"L'h√©parine augmente l'antithrombine III."}},
{en:"How is insulin administered?",fr:"Comment l'insuline est-elle administr√©e ?",a:{en:["Subcutaneous","Oral","Intravenous","Topical"],fr:["Sous-cutan√©e","Orale","Intraveineuse","Topique"]},ca:0,exp:{en:"Insulin is destroyed by stomach acid.",fr:"L'insuline est d√©truite par l'acide gastrique."}},
{en:"What treats depression?",fr:"Quel m√©dicament traite la d√©pression ?",a:{en:["Fluoxetine","Ibuprofen","Omeprazole","Metformin"],fr:["Fluox√©tine","Ibuprof√®ne","Om√©prazole","Metformine"]},ca:0,exp:{en:"Fluoxetine is an SSRI.",fr:"La fluox√©tine est un ISRS."}},
{en:"What is first-pass metabolism?",fr:"Qu'est-ce que le m√©tabolisme de premier passage ?",a:{en:["Drug metabolism in liver before systemic circulation","Drug absorption in stomach","Drug elimination by kidneys","Drug distribution to tissues"],fr:["M√©tabolisme h√©patique avant circulation syst√©mique","Absorption gastrique","√âlimination r√©nale","Distribution tissulaire"]},ca:0,exp:{en:"First-pass reduces oral bioavailability.",fr:"Le premier passage r√©duit la biodisponibilit√©."}},
{en:"Which is a diuretic?",fr:"Quel m√©dicament est un diur√©tique ?",a:{en:["Furosemide","Atenolol","Lisinopril","Amlodipine"],fr:["Furos√©mide","At√©nolol","Lisinopril","Amlodipine"]},ca:0,exp:{en:"Furosemide is a loop diuretic.",fr:"Le furos√©mide est un diur√©tique de l'anse."}}
]},
year5:{label:{en:"YEAR 5 ‚Äî INTERNAL MEDICINE",fr:"ANN√âE 5 ‚Äî M√âDECINE INTERNE"},qs:[
{en:"What causes heart failure most commonly?",fr:"Quelle est la cause la plus fr√©quente d'insuffisance cardiaque ?",a:{en:["Coronary artery disease","Valvular disease","Cardiomyopathy","Arrhythmia"],fr:["Maladie coronarienne","Maladie valvulaire","Cardiomyopathie","Arythmie"]},ca:0,exp:{en:"CAD reduces blood supply to heart muscle.",fr:"La maladie coronarienne r√©duit l'apport."}},
{en:"What test diagnoses diabetes?",fr:"Quel test diagnostique le diab√®te ?",a:{en:["HbA1c","CBC","Lipid panel","Liver function test"],fr:["HbA1c","NFS","Bilan lipidique","Test fonction h√©patique"]},ca:0,exp:{en:"HbA1c ‚â•6.5% indicates diabetes.",fr:"Une HbA1c ‚â•6,5% indique un diab√®te."}},
{en:"What treats hypothyroidism?",fr:"Quel est le traitement de l'hypothyro√Ødie ?",a:{en:["Levothyroxine","Methimazole","Radioactive iodine","Beta blockers"],fr:["L√©vothyroxine","M√©thimazole","Iode radioactif","B√™ta-bloquants"]},ca:0,exp:{en:"Levothyroxine replaces thyroid hormone.",fr:"La l√©vothyroxine remplace l'hormone."}},
{en:"What is associated with H. pylori?",fr:"Quelle condition est associ√©e √† H. pylori ?",a:{en:["Peptic ulcer disease","GERD","Crohn's disease","Ulcerative colitis"],fr:["Maladie ulc√©reuse peptique","RGO","Maladie de Crohn","Colite ulc√©reuse"]},ca:0,exp:{en:"H. pylori causes chronic gastritis and ulcers.",fr:"H. pylori cause la gastrite et les ulc√®res."}},
{en:"First-line hypertension treatment?",fr:"Traitement de premi√®re intention de l'hypertension ?",a:{en:["Thiazide diuretics","Beta blockers","ACE inhibitors","Calcium channel blockers"],fr:["Diur√©tiques thiazidiques","B√™ta-bloquants","Inhibiteurs ACE","Bloqueurs calciques"]},ca:0,exp:{en:"Thiazides are often first-line.",fr:"Les thiazidiques sont souvent de premi√®re intention."}},
{en:"What causes joint inflammation?",fr:"Quelle maladie cause une inflammation articulaire ?",a:{en:["Rheumatoid arthritis","Osteoporosis","Osteoarthritis","Gout"],fr:["Polyarthrite rhumato√Øde","Ost√©oporose","Ost√©oarthrite","Goutte"]},ca:0,exp:{en:"RA is autoimmune inflammatory arthritis.",fr:"La PR est une arthrite auto-immune."}},
{en:"What marks nephrotic syndrome?",fr:"Quelle est la caract√©ristique du syndrome n√©phrotique ?",a:{en:["Proteinuria","Hematuria","Oliguria","Polyuria"],fr:["Prot√©inurie","H√©maturie","Oligurie","Polyurie"]},ca:0,exp:{en:"Proteinuria >3.5g/day defines nephrotic syndrome.",fr:"Prot√©inurie >3,5g/jour d√©finit le syndrome."}},
{en:"What causes elevated troponin?",fr:"Quelle condition cause une √©l√©vation de la troponine ?",a:{en:["Myocardial infarction","Stroke","Pulmonary embolism","Pneumonia"],fr:["Infarctus du myocarde","AVC","Embolie pulmonaire","Pneumonie"]},ca:0,exp:{en:"Troponin is specific for cardiac damage.",fr:"La troponine est sp√©cifique des dommages cardiaques."}},
{en:"What treats COPD exacerbation?",fr:"Quel est le traitement de l'exacerbation de la BPCO ?",a:{en:["Bronchodilators + steroids","Antibiotics only","Surgery","Oxygen only"],fr:["Bronchodilatateurs + st√©ro√Ødes","Antibiotiques seulement","Chirurgie","Oxyg√®ne seulement"]},ca:0,exp:{en:"Combination therapy reduces inflammation.",fr:"La th√©rapie combin√©e r√©duit l'inflammation."}},
{en:"What affects the myelin sheath?",fr:"Quelle maladie affecte la gaine de my√©line ?",a:{en:["Multiple sclerosis","Parkinson's","Alzheimer's","ALS"],fr:["Scl√©rose en plaques","Parkinson","Alzheimer","SLA"]},ca:0,exp:{en:"MS is autoimmune demyelination.",fr:"La SEP est une d√©my√©linisation auto-immune."}},
{en:"Most common anemia type?",fr:"Quel est le type d'an√©mie le plus courant ?",a:{en:["Iron deficiency","B12 deficiency","Folate deficiency","Hemolytic"],fr:["Carence en fer","Carence en B12","Carence en folate","H√©molytique"]},ca:0,exp:{en:"Iron deficiency is most common worldwide.",fr:"La carence en fer est la plus courante."}},
{en:"What is associated with obesity?",fr:"Quelle condition est associ√©e √† l'ob√©sit√© ?",a:{en:["Type 2 diabetes","Type 1 diabetes","Hypothyroidism","Addison's disease"],fr:["Diab√®te type 2","Diab√®te type 1","Hypothyro√Ødie","Maladie d'Addison"]},ca:0,exp:{en:"Obesity causes insulin resistance.",fr:"L'ob√©sit√© cause la r√©sistance √† l'insuline."}},
{en:"What treats atrial fibrillation?",fr:"Quel est le traitement de la fibrillation auriculaire ?",a:{en:["Anticoagulants + rate control","Antibiotics","Diuretics","Beta blockers only"],fr:["Anticoagulants + contr√¥le du rythme","Antibiotiques","Diur√©tiques","B√™ta-bloquants seulement"]},ca:0,exp:{en:"Anticoagulation prevents stroke.",fr:"L'anticoagulation pr√©vient l'AVC."}},
{en:"What diagnoses MI?",fr:"Quel test diagnostique l'infarctus du myocarde ?",a:{en:["ECG + troponin","CBC","X-ray","MRI"],fr:["ECG + troponine","NFS","Radiographie","IRM"]},ca:0,exp:{en:"ECG shows ST changes; troponin confirms.",fr:"L'ECG montre ST ; la troponine confirme."}},
{en:"What causes cirrhosis?",fr:"Quelle est la cause de la cirrhose ?",a:{en:["Chronic liver damage","Acute infection","Trauma","Genetic disorder"],fr:["Dommage h√©patique chronique","Infection aigu√´","Traumatisme","Trouble g√©n√©tique"]},ca:0,exp:{en:"Chronic damage leads to fibrosis.",fr:"Les dommages chroniques m√®nent √† la fibrose."}},
{en:"Which disease is autoimmune?",fr:"Quelle maladie est auto-immune ?",a:{en:["Lupus","Osteoarthritis","Osteoporosis","Gout"],fr:["Lupus","Ost√©oarthrite","Ost√©oporose","Goutte"]},ca:0,exp:{en:"SLE is a systemic autoimmune disease.",fr:"Le LES est une maladie auto-immune."}},
{en:"What treats seizures?",fr:"Quel est le traitement des convulsions ?",a:{en:["Anticonvulsants","Antibiotics","Antivirals","Antifungals"],fr:["Anticonvulsivants","Antibiotiques","Antiviraux","Antifongiques"]},ca:0,exp:{en:"Anticonvulsants stabilize neuronal activity.",fr:"Les anticonvulsivants stabilisent."}},
{en:"What causes jaundice?",fr:"Quelle condition cause la jaunisse ?",a:{en:["Liver disease","Heart disease","Kidney disease","Lung disease"],fr:["Maladie h√©patique","Maladie cardiaque","Maladie r√©nale","Maladie pulmonaire"]},ca:0,exp:{en:"Jaundice results from elevated bilirubin.",fr:"La jaunisse r√©sulte de la bilirubine √©lev√©e."}},
{en:"What marks Crohn's disease?",fr:"Quelle est la caract√©ristique de la maladie de Crohn ?",a:{en:["Transmural inflammation","Mucosal inflammation only","Vascular inflammation","Nerve inflammation"],fr:["Inflammation transmurale","Inflammation muqueuse seulement","Inflammation vasculaire","Inflammation nerveuse"]},ca:0,exp:{en:"Crohn's affects all bowel wall layers.",fr:"Crohn affecte toutes les couches."}},
{en:"What treats GERD?",fr:"Quel m√©dicament traite le RGO ?",a:{en:["Proton pump inhibitors","Antibiotics","Antivirals","Antifungals"],fr:["Inhibiteurs de la pompe √† protons","Antibiotiques","Antiviraux","Antifongiques"]},ca:0,exp:{en:"PPIs are most effective for GERD.",fr:"Les IPP sont les plus efficaces."}}
]},
year6:{label:{en:"YEAR 6 ‚Äî SURGERY & SPECIALTIES",fr:"ANN√âE 6 ‚Äî CHIRURGIE & SP√âCIALIT√âS"},qs:[
{en:"What is the most common surgical emergency?",fr:"Quelle est l'urgence chirurgicale la plus courante ?",a:{en:["Appendicitis","Cholecystitis","Bowel obstruction","Perforated ulcer"],fr:["Appendicite","Chol√©cystite","Occlusion intestinale","Ulc√®re perfor√©"]},ca:0,exp:{en:"Appendicitis is the most common surgical emergency.",fr:"L'appendicite est l'urgence la plus courante."}},
{en:"Which suture is absorbable?",fr:"Quel mat√©riau de suture est absorbable ?",a:{en:["Vicryl","Silk","Nylon","Prolene"],fr:["Vicryl","Soie","Nylon","Prol√®ne"]},ca:0,exp:{en:"Vicryl (polyglactin) is absorbable.",fr:"Vicryl (polyglactine) est absorbable."}},
{en:"What treats acute cholecystitis?",fr:"Quel est le traitement de la chol√©cystite aigu√´ ?",a:{en:["Cholecystectomy","Antibiotics only","Observation","Drainage only"],fr:["Chol√©cystectomie","Antibiotiques seulement","Observation","Drainage seulement"]},ca:0,exp:{en:"Laparoscopic cholecystectomy is definitive.",fr:"La chol√©cystectomie laparoscopique est d√©finitive."}},
{en:"Which fracture is common in elderly?",fr:"Quelle fracture est courante chez les personnes √¢g√©es ?",a:{en:["Hip fracture","Skull fracture","Rib fracture","Clavicle fracture"],fr:["Fracture de la hanche","Fracture du cr√¢ne","Fracture de c√¥te","Fracture de la clavicule"]},ca:0,exp:{en:"Hip fractures are common due to osteoporosis.",fr:"Les fractures de hanche sont courantes."}},
{en:"Gold standard for appendicitis?",fr:"√âtalon-or pour le diagnostic d'appendicite ?",a:{en:["CT scan","X-ray","Ultrasound","MRI"],fr:["Scanner","Radiographie","√âchographie","IRM"]},ca:0,exp:{en:"CT has highest sensitivity and specificity.",fr:"Le scanner a la plus haute sensibilit√©."}},
{en:"What surgery treats hernia?",fr:"Quelle chirurgie traite la hernie ?",a:{en:["Herniorrhaphy","Appendectomy","Cholecystectomy","Colectomy"],fr:["Herniorraphie","Appendicectomie","Chol√©cystectomie","Colectomie"]},ca:0,exp:{en:"Herniorrhaphy repairs the hernia defect.",fr:"L'herniorraphie r√©pare le d√©faut."}},
{en:"Complication of thyroid surgery?",fr:"Complication de la chirurgie thyro√Ødienne ?",a:{en:["Hypocalcemia","Hypercalcemia","Hyperglycemia","Hypoglycemia"],fr:["Hypocalc√©mie","Hypercalc√©mie","Hyperglyc√©mie","Hypoglyc√©mie"]},ca:0,exp:{en:"Parathyroid damage causes hypocalcemia.",fr:"Les dommages parathyro√Ødiens causent l'hypocalc√©mie."}},
{en:"Most commonly transplanted organ?",fr:"Quel organe est le plus souvent transplant√© ?",a:{en:["Kidney","Heart","Liver","Lung"],fr:["Rein","C≈ìur","Foie","Poumon"]},ca:0,exp:{en:"Kidney transplants are most common.",fr:"Les transplantations r√©nales sont les plus courantes."}},
{en:"What treats bowel obstruction?",fr:"Quel est le traitement de l'occlusion intestinale ?",a:{en:["Surgery + NG tube","Antibiotics only","Observation","Laxatives"],fr:["Chirurgie + sonde NG","Antibiotiques seulement","Observation","Laxatifs"]},ca:0,exp:{en:"NG tube decompresses; surgery may be needed.",fr:"La sonde NG d√©compresse."}},
{en:"What requires emergency surgery?",fr:"Quelle condition n√©cessite une chirurgie d'urgence ?",a:{en:["Perforated viscus","Gallstones","Hernia","Appendicitis"],fr:["Visc√®re perfor√©","Calculs biliaires","Hernie","Appendicite"]},ca:0,exp:{en:"Perforation causes peritonitis.",fr:"La perforation cause une p√©ritonite."}},
{en:"Purpose of surgical drains?",fr:"Quel est le but des drains chirurgicaux ?",a:{en:["Remove fluid/blood","Deliver medication","Monitor pressure","Prevent infection"],fr:["√âliminer liquide/sang","Administrer m√©dicaments","Surveiller pression","Pr√©venir infection"]},ca:0,exp:{en:"Drains prevent fluid accumulation.",fr:"Les drains pr√©viennent l'accumulation."}},
{en:"Anesthesia for C-section?",fr:"Quelle anesth√©sie pour la c√©sarienne ?",a:{en:["Spinal/epidural","General","Local","None"],fr:["Rachianesth√©sie/p√©ridurale","G√©n√©rale","Locale","Aucune"]},ca:0,exp:{en:"Regional allows mother to be awake.",fr:"L'anesth√©sie r√©gionale permet d'√™tre √©veill√©."}},
{en:"What treats traumatic brain injury?",fr:"Quel est le traitement du traumatisme cr√¢nien ?",a:{en:["ICP monitoring + surgery","Antibiotics","Antivirals","Observation only"],fr:["Surveillance PIC + chirurgie","Antibiotiques","Antiviraux","Observation seulement"]},ca:0,exp:{en:"ICP monitoring guides treatment.",fr:"La surveillance du PIC guide le traitement."}},
{en:"What surgery treats breast cancer?",fr:"Quelle chirurgie traite le cancer du sein ?",a:{en:["Mastectomy","Appendectomy","Cholecystectomy","Hysterectomy"],fr:["Mastectomie","Appendicectomie","Chol√©cystectomie","Hyst√©rectomie"]},ca:0,exp:{en:"Mastectomy or lumpectomy depending on stage.",fr:"Mastectomie ou tumorectomie selon le stade."}},
{en:"Complication of splenectomy?",fr:"Complication de la spl√©nectomie ?",a:{en:["Increased infection risk","Bleeding","Liver failure","Kidney failure"],fr:["Risque d'infection accru","Saignement","Insuffisance h√©patique","Insuffisance r√©nale"]},ca:0,exp:{en:"Spleen removes encapsulated bacteria.",fr:"La rate √©limine les bact√©ries encapsul√©es."}},
{en:"What treats kidney stones?",fr:"Quelle proc√©dure traite les calculs r√©naux ?",a:{en:["Lithotripsy","Nephrectomy","Dialysis","Transplant"],fr:["Lithotritie","N√©phrectomie","Dialyse","Transplantation"]},ca:0,exp:{en:"ESWL breaks stones with shock waves.",fr:"La LEC brise les calculs."}},
{en:"What treats varicose veins?",fr:"Quel est le traitement des varices ?",a:{en:["Sclerotherapy","Antibiotics","Antivirals","Antifungals"],fr:["Scl√©roth√©rapie","Antibiotiques","Antiviraux","Antifongiques"]},ca:0,exp:{en:"Sclerotherapy injects solution to close veins.",fr:"La scl√©roth√©rapie ferme les veines."}},
{en:"What surgery treats carpal tunnel?",fr:"Quelle chirurgie traite le syndrome du canal carpien ?",a:{en:["Carpal tunnel release","Amputation","Fusion","Replacement"],fr:["Lib√©ration du canal carpien","Amputation","Fusion","Remplacement"]},ca:0,exp:{en:"Release cuts the transverse ligament.",fr:"La lib√©ration coupe le ligament."}},
{en:"Purpose of surgical staplers?",fr:"Quel est le but des agrafeuses chirurgicales ?",a:{en:["Close incisions quickly","Cut tissue","Suction","Cauterize"],fr:["Fermer incisions rapidement","Couper tissu","Aspirer","Caut√©riser"]},ca:0,exp:{en:"Staplers provide quick closure.",fr:"Les agrafeuses fournissent une fermeture rapide."}},
{en:"What requires bypass surgery?",fr:"Quelle condition n√©cessite une chirurgie de pontage ?",a:{en:["Coronary artery disease","Appendicitis","Hernia","Gallstones"],fr:["Maladie coronarienne","Appendicite","Hernie","Calculs biliaires"]},ca:0,exp:{en:"CABG bypasses blocked arteries.",fr:"Le PACG contourne les art√®res bloqu√©es."}}
]},
year7:{label:{en:"YEAR 7 ‚Äî CLINICAL MEDICINE & EMERGENCY",fr:"ANN√âE 7 ‚Äî M√âDECINE CLINIQUE & URGENCES"},qs:[
{en:"What is the first step in ACLS?",fr:"Quelle est la premi√®re √©tape de l'ACLS ?",a:{en:["Check responsiveness","Start CPR","Defibrillate","Give epinephrine"],fr:["V√©rifier la r√©activit√©","Commencer RCP","D√©fibriller","Donner √©pin√©phrine"]},ca:0,exp:{en:"Always check responsiveness first.",fr:"Toujours v√©rifier la r√©activit√© en premier."}},
{en:"What treats anaphylactic shock?",fr:"Quel est le traitement du choc anaphylactique ?",a:{en:["Epinephrine IM","Antihistamines only","Steroids only","Observation"],fr:["√âpin√©phrine IM","Antihistaminiques seulement","St√©ro√Ødes seulement","Observation"]},ca:0,exp:{en:"IM epinephrine is first-line.",fr:"L'√©pin√©phrine IM est de premi√®re intention."}},
{en:"What score assesses stroke severity?",fr:"Quel score √©value la gravit√© de l'AVC ?",a:{en:["NIHSS","Glasgow","APACHE","SOFA"],fr:["NIHSS","Glasgow","APACHE","SOFA"]},ca:0,exp:{en:"NIH Stroke Scale quantifies impairment.",fr:"L'√©chelle NIH quantifie les d√©ficiences."}},
{en:"What treats opioid overdose?",fr:"Quel est le traitement du surdosage d'opio√Ødes ?",a:{en:["Naloxone","Flumazenil","Atropine","Epinephrine"],fr:["Naloxone","Flumaz√©nil","Atropine","√âpin√©phrine"]},ca:0,exp:{en:"Naloxone rapidly reverses opioids.",fr:"La naloxone inverse rapidement."}},
{en:"What causes Kussmaul breathing?",fr:"Quelle condition cause la respiration de Kussmaul ?",a:{en:["Diabetic ketoacidosis","Asthma","COPD","Pneumonia"],fr:["Acidoc√©tose diab√©tique","Asthme","BPCO","Pneumonie"]},ca:0,exp:{en:"Deep breathing compensates for acidosis.",fr:"Respiration profonde compense l'acidose."}},
{en:"First-line treatment for seizures?",fr:"Traitement de premi√®re intention des convulsions ?",a:{en:["Benzodiazepines","Antibiotics","Antivirals","Antifungals"],fr:["Benzodiaz√©pines","Antibiotiques","Antiviraux","Antifongiques"]},ca:0,exp:{en:"Benzos stop active seizures.",fr:"Les benzos arr√™tent les convulsions."}},
{en:"What diagnoses pulmonary embolism?",fr:"Quel test diagnostique l'embolie pulmonaire ?",a:{en:["CT pulmonary angiogram","X-ray","ECG","CBC"],fr:["Angioscanner pulmonaire","Radiographie","ECG","NFS"]},ca:0,exp:{en:"CTPA is gold standard for PE.",fr:"L'angioscanner est l'√©talon-or."}},
{en:"What treats hypoglycemia?",fr:"Quel est le traitement de l'hypoglyc√©mie ?",a:{en:["Oral glucose/IV dextrose","Insulin","Metformin","Glucagon only"],fr:["Glucose oral/dextrose IV","Insuline","Metformine","Glucagon seulement"]},ca:0,exp:{en:"Give fast carbs if conscious.",fr:"Donner des glucides rapides si conscient."}},
{en:"What requires intubation?",fr:"Quelle condition n√©cessite une intubation ?",a:{en:["Respiratory failure","Mild asthma","Common cold","Headache"],fr:["Insuffisance respiratoire","Asthme l√©ger","Rhume","Maux de t√™te"]},ca:0,exp:{en:"Intubation secures airway.",fr:"L'intubation s√©curise les voies a√©riennes."}},
{en:"What is GCS range?",fr:"Quelle est l'√©chelle de Glasgow ?",a:{en:["3-15","1-10","0-20","5-25"],fr:["3-15","1-10","0-20","5-25"]},ca:0,exp:{en:"GCS 3 = deepest coma; 15 = alert.",fr:"GCS 3 = coma profond ; 15 = alerte."}},
{en:"What drug treats cardiac arrest?",fr:"Quel m√©dicament traite l'arr√™t cardiaque ?",a:{en:["Epinephrine","Insulin","Metformin","Aspirin"],fr:["√âpin√©phrine","Insuline","Metformine","Aspirine"]},ca:0,exp:{en:"Epinephrine increases perfusion pressure.",fr:"L'√©pin√©phrine augmente la perfusion."}},
{en:"What treats tension pneumothorax?",fr:"Quel est le traitement du pneumothorax sous tension ?",a:{en:["Needle decompression","Antibiotics","Antivirals","Observation"],fr:["D√©compression √† l'aiguille","Antibiotiques","Antiviraux","Observation"]},ca:0,exp:{en:"Immediate needle decompression first.",fr:"D√©compression imm√©diate √† l'aiguille."}},
{en:"What causes cherry-red skin?",fr:"Quelle condition cause une peau rouge cerise ?",a:{en:["Carbon monoxide poisoning","Cyanide poisoning","Methanol poisoning","Ethanol poisoning"],fr:["Intoxication au CO","Intoxication au cyanure","Intoxication au m√©thanol","Intoxication √† l'√©thanol"]},ca:0,exp:{en:"CO forms carboxyhemoglobin.",fr:"Le CO forme la carboxyh√©moglobine."}},
{en:"What is the treatment for burns?",fr:"Quel est le traitement des br√ªlures ?",a:{en:["Cool water + dressing","Ice directly","Butter","Toothpaste"],fr:["Eau fra√Æche + pansement","Glace directement","Beurre","Dentifrice"]},ca:0,exp:{en:"Cool running water for 20 min.",fr:"Eau fra√Æche courante pendant 20 min."}},
{en:"What predicts ICU mortality?",fr:"Quel score pr√©dit la mortalit√© en r√©animation ?",a:{en:["APACHE II","Glasgow","NIHSS","CHA2DS2-VASc"],fr:["APACHE II","Glasgow","NIHSS","CHA2DS2-VASc"]},ca:0,exp:{en:"APACHE II uses physiologic variables.",fr:"APACHE II utilise des variables physiologiques."}},
{en:"What treats septic shock?",fr:"Quel est le traitement du choc septique ?",a:{en:["Fluids + antibiotics + vasopressors","Antibiotics only","Fluids only","Steroids only"],fr:["Liquides + antibiotiques + vasopresseurs","Antibiotiques seulement","Liquides seulement","St√©ro√Ødes seulement"]},ca:0,exp:{en:"Early antibiotics and fluids are critical.",fr:"Les antibiotiques pr√©coces sont critiques."}},
{en:"What causes Battle's sign?",fr:"Quelle condition cause le signe de Battle ?",a:{en:["Basilar skull fracture","Rib fracture","Hip fracture","Spinal fracture"],fr:["Fracture de la base du cr√¢ne","Fracture de c√¥te","Fracture de hanche","Fracture vert√©brale"]},ca:0,exp:{en:"Battle's sign is bruising behind ear.",fr:"Le signe de Battle est une ecchymose."}},
{en:"What treats hyperkalemia?",fr:"Quel est le traitement de l'hyperkali√©mie ?",a:{en:["Calcium gluconate + insulin","Potassium supplements","Sodium supplements","Magnesium supplements"],fr:["Gluconate de calcium + insuline","Suppl√©ments de potassium","Suppl√©ments de sodium","Suppl√©ments de magn√©sium"]},ca:0,exp:{en:"Calcium stabilizes cardiac membrane.",fr:"Le calcium stabilise la membrane."}},
{en:"What reverses benzodiazepines?",fr:"Quel m√©dicament inverse les benzodiaz√©pines ?",a:{en:["Flumazenil","Naloxone","Atropine","Epinephrine"],fr:["Flumaz√©nil","Naloxone","Atropine","√âpin√©phrine"]},ca:0,exp:{en:"Flumazenil is a GABA-A antagonist.",fr:"Le flumaz√©nil est un antagoniste GABA-A."}},
{en:"First step in trauma assessment?",fr:"Premi√®re √©tape de l'√©valuation du traumatisme ?",a:{en:["ABCDE survey","CT scan","X-ray","Blood tests"],fr:["Enqu√™te ABCDE","Scanner","Radiographie","Tests sanguins"]},ca:0,exp:{en:"Primary survey identifies life threats.",fr:"L'enqu√™te primaire identifie les menaces."}}
]}
};

// ============================================================
// TRANSLATIONS
// ============================================================
const T = {
en:{
year:"YEAR",level:"LEVEL",score:"SCORE",paused:"PAUSED",resume:"RESUME",
restart:"RESTART LEVEL",quit:"QUIT",skip:"SKIP (10s)",yearComplete:"YEAR COMPLETE!",
nextYear:"CONTINUE",congrats:"Congratulations! You have completed",
doctor:"Year of Medical School!",
certTitle:"IS OFFICIALLY A DOCTOR OF MEDICINE",
certSchool:"DOCTOR QUEST MEDICAL SCHOOL",
certPresents:"THIS CERTIFIES THAT",
certBody:"Having successfully completed seven years of rigorous medical education.",
sigDean:"DEAN OF MEDICINE",sigReg:"MEDICAL REGISTRAR",
saveCert:"SAVE CERTIFICATE",playAgain:"PLAY AGAIN",
graduates:"GRADUATES",
howToPlay:"üì± SWIPE on screen to move (left/right/up/down)\n\nüéØ Answer 3 medical questions per level\n\nüîì Find the GREEN exit to advance\n\n‚ö° Build streaks for bonus points!\n\nüíæ Your progress auto-saves",
langBtn:"üåê LANGUAGE: ENGLISH",startBtn:"üéì BEGIN MEDICAL SCHOOL",continueBtn:"üìÇ CONTINUE PROGRESS",howBtn:"‚ùì HOW TO PLAY",
correct:"‚úì CORRECT!",wrong:"‚úó INCORRECT",
narrator1:"Find the green exit to advance!",
narrator2:"Answer questions to unlock the exit!",
narrator3:"Year ",narrator4:" Level ",
exitLocked:"Answer all 3 questions to unlock the exit!",
exitOpen:"EXIT UNLOCKED ‚Äî Reach the green square!",
yearComp1:"You have completed Year ",yearComp2:" of Medical School!",
questionTitle:"MEDICAL QUESTION",
encouraging:["Excellent! üåü","Perfect! üéØ","Brilliant! üí°","Outstanding! üèÜ","Amazing! ‚≠ê","Great job! üëè","Well done! üéâ","Fantastic! üöÄ","Superb! üí™","Correct! ‚úÖ"],
saveLoaded:"Welcome back, Dr. ",
enterName:"Enter your name to start"
},
fr:{
year:"ANN√âE",level:"NIVEAU",score:"SCORE",paused:"PAUSE",resume:"REPRENDRE",
restart:"RECOMMENCER",quit:"QUITTER",skip:"PASSER (10s)",yearComplete:"ANN√âE TERMIN√âE !",
nextYear:"CONTINUER",congrats:"F√©licitations ! Vous avez termin√© l'",
doctor:"Ann√©e de l'√âcole de M√©decine !",
certTitle:"EST OFFICIELLEMENT DOCTEUR EN M√âDECINE",
certSchool:"√âCOLE DE M√âDECINE DOCTOR QUEST",
certPresents:"LE PR√âSENT CERTIFICAT ATTESTE QUE",
certBody:"Ayant r√©ussi sept ans d'enseignement m√©dical rigoureux.",
sigDean:"DOYEN DE M√âDECINE",sigReg:"REGISTRAIRE M√âDICAL",
saveCert:"ENREGISTRER",playAgain:"REJOUER",
graduates:"DIPL√îM√âS",
howToPlay:"üì± GLISSEZ sur l'√©cran pour vous d√©placer\n\nüéØ R√©pondez √† 3 questions par niveau\n\nüîì Trouvez la SORTIE VERTE pour avancer\n\n‚ö° Accumulez des s√©ries pour des points !\n\nüíæ Votre progression sauvegarde auto",
langBtn:"üåê LANGUE : FRAN√áAIS",startBtn:"üéì COMMENCER L'√âCOLE",continueBtn:"üìÇ CONTINUER",howBtn:"‚ùì COMMENT JOUER",
correct:"‚úì CORRECT !",wrong:"‚úó INCORRECT",
narrator1:"Trouvez la sortie verte pour avancer !",
narrator2:"R√©pondez aux questions pour d√©bloquer la sortie !",
narrator3:"Ann√©e ",narrator4:" Niveau ",
exitLocked:"R√©pondez aux 3 questions pour d√©bloquer la sortie !",
exitOpen:"SORTIE D√âVERROUILL√âE ‚Äî Atteignez le carr√© vert !",
yearComp1:"Vous avez termin√© l'Ann√©e ",yearComp2:" de l'√âcole de M√©decine !",
questionTitle:"QUESTION M√âDICALE",
encouraging:["Excellent ! üåü","Parfait ! üéØ","Brillant ! üí°","Exceptionnel ! üèÜ","Incroyable ! ‚≠ê","Bon travail ! üëè","Bien jou√© ! üéâ","Fantastique ! üöÄ","Superbe ! üí™","Correct ! ‚úÖ"],
saveLoaded:"Bon retour, Dr. ",
enterName:"Entrez votre nom pour commencer"
},
};

// ============================================================
// SAVE SYSTEM - LOCALSTORAGE
// ============================================================
const SaveSystem = {
key:'dq_save_v4',
load(){
try{
const data=localStorage.getItem(this.key);
if(data)return JSON.parse(data);
}catch(e){console.error('Load error:',e)}
return null;
},
save(state){
try{
localStorage.setItem(this.key,JSON.stringify(state));
return true;
}catch(e){console.error('Save error:',e);return false}
},
clear(){
localStorage.removeItem(this.key);
},
hasSave(){
return localStorage.getItem(this.key) !== null;
}
};

// ============================================================
// ACHIEVEMENTS
// ============================================================
const Achievements = {
key:'dq_achievements_v2',
unlocked:[],
check(id){
if(this.unlocked.includes(id))return false;
this.unlocked.push(id);
this.save();
this.show(id);
return true;
},
show(id){
const ach={
firstStep:{en:"First Steps",fr:"Premiers Pas"},
streak5:{en:"On Fire!",fr:"En Feu !"},
streak10:{en:"Unstoppable!",fr:"Imbattable !"},
year1:{en:"Resident",fr:"Interne"},
year3:{en:"Senior Resident",fr:"Interne Senior"},
year7:{en:"Doctor!",fr:"Docteur !"},
score1000:{en:"Scholar",fr:"√ârudit"},
score5000:{en:"Expert",fr:"Expert"}
};
const popup=document.getElementById('achPopup');
const desc=document.getElementById('achDesc');
desc.textContent=ach[id]?ach[id][g.lang]:id;
popup.classList.add('show');
setTimeout(()=>popup.classList.remove('show'),3000);
},
save(){localStorage.setItem(this.key,JSON.stringify(this.unlocked));},
load(){
try{
const data=localStorage.getItem(this.key);
if(data)this.unlocked=JSON.parse(data);
}catch(e){}
}
};

// ============================================================
// GAME STATE
// ============================================================
const g = {
canvas:null,ctx:null,W:0,H:0,
cs:32,
running:false,paused:false,
year:1,level:1,
answered:0,
score:0,
streak:0,
maze:[],mazeW:0,mazeH:0,
exit:{x:0,y:0},
px:1,py:1,
rx:0,ry:0,
tx:0,ty:0,
moving:false,
moveDir:null,
moveProgress:0,
robotFrame:0,robotTimer:0,
eyeOffset:0,eyeTimer:0,
pool:[],
exitLocked:true,
questionShowing:false,
skipTimer:0,
skipMax:10000,
currentCorrectIndex:-1,
currentExplanation:'',
particles:[],
touchStartX:0,touchStartY:0,touchActive:false,
lang:'en',
playerName:'',
graduated:parseInt(localStorage.getItem('dq_grad'))||0,
lastTime:0,raf:null,
cellOffX:0,cellOffY:0,
questionSpots:[],
triggeredSpots:new Set(),
touchHintShown:false,
hasSave:false
};

// ============================================================
// CANVAS & TOUCH CONTROLS
// ============================================================
function initCanvas(){
g.canvas=document.getElementById('c');
g.ctx=g.canvas.getContext('2d');
resize();
window.addEventListener('resize',resize);

const touchOverlay=document.getElementById('touchOverlay');

touchOverlay.addEventListener('touchstart',(e)=>{
if(!g.running||g.paused||g.questionShowing||g.moving)return;
e.preventDefault();
g.touchActive=true;
g.touchStartX=e.touches[0].clientX;
g.touchStartY=e.touches[0].clientY;

const rect=touchOverlay.getBoundingClientRect();
const touchX=g.touchStartX-rect.left;
const touchY=g.touchStartY-rect.top;
const zoneWidth=rect.width/2;
const zoneHeight=rect.height/2;

resetIndicators();
if(touchX<zoneWidth){
if(touchY<zoneHeight){
document.getElementById('indicatorUp').style.opacity='1';
}else{
document.getElementById('indicatorDown').style.opacity='1';
}
document.getElementById('indicatorLeft').style.opacity='1';
}else{
if(touchY<zoneHeight){
document.getElementById('indicatorUp').style.opacity='1';
}else{
document.getElementById('indicatorDown').style.opacity='1';
}
document.getElementById('indicatorRight').style.opacity='1';
}

if(!g.touchHintShown){
document.getElementById('touchHint').classList.add('show');
g.touchHintShown=true;
setTimeout(()=>document.getElementById('touchHint').classList.remove('show'),3000);
}
},{passive:false});

touchOverlay.addEventListener('touchmove',(e)=>{
if(!g.touchActive)return;
e.preventDefault();

const rect=touchOverlay.getBoundingClientRect();
const touchX=e.touches[0].clientX-rect.left;
const touchY=e.touches[0].clientY-rect.top;
const dx=touchX-g.touchStartX;
const dy=touchY-g.touchStartY;
const absDx=Math.abs(dx),absDy=Math.abs(dy);

resetIndicators();
if(absDx>absDy){
if(dx>0){
document.getElementById('indicatorRight').style.opacity='1';
}else{
document.getElementById('indicatorLeft').style.opacity='1';
}
}else{
if(dy>0){
document.getElementById('indicatorDown').style.opacity='1';
}else{
document.getElementById('indicatorUp').style.opacity='1';
}
}
},{passive:false});

touchOverlay.addEventListener('touchend',(e)=>{
if(!g.touchActive)return;
e.preventDefault();
g.touchActive=false;

const rect=touchOverlay.getBoundingClientRect();
const touchEndX=e.changedTouches[0].clientX;
const touchEndY=e.changedTouches[0].clientY;
const dx=touchEndX-g.touchStartX;
const dy=touchEndY-g.touchStartY;
const absDx=Math.abs(dx),absDy=Math.abs(dy);

resetIndicators();

const threshold=25;
if(absDx>absDy&&absDx>threshold){
if(dx>0)tryMove(1,0);
else tryMove(-1,0);
}else if(absDy>absDx&&absDy>threshold){
if(dy>0)tryMove(0,1);
else tryMove(0,-1);
}
},{passive:false});
}

function resetIndicators(){
document.getElementById('indicatorUp').style.opacity='0';
document.getElementById('indicatorDown').style.opacity='0';
document.getElementById('indicatorLeft').style.opacity='0';
document.getElementById('indicatorRight').style.opacity='0';
}

function resize(){
g.W=window.innerWidth;g.H=window.innerHeight;
g.canvas.width=g.W;g.canvas.height=g.H;
if(g.running)recalcOffsets();
}

function recalcOffsets(){
g.cellOffX=Math.floor((g.W - g.mazeW*g.cs)/2);
g.cellOffY=Math.floor((g.H - g.mazeH*g.cs)/2)+10;
}

// ============================================================
// MAZE GENERATION
// ============================================================
function genMaze(){
const base = 19 + (g.year-1)*2 + (g.level-1);
const w = Math.min(base, Math.floor((g.W-40)/g.cs));
const h = Math.min(base, Math.floor((g.H-80)/g.cs));
const mw = w%2===0?w-1:w;
const mh = h%2===0?h-1:h;
g.mazeW=mw;g.mazeH=mh;
const maze = Array.from({length:mh},()=>new Array(mw).fill(1));
const carve=(x,y)=>{
maze[y][x]=0;
const dirs=[[0,-2],[2,0],[0,2],[-2,0]].sort(()=>Math.random()-.5);
for(const[dx,dy]of dirs){
const nx=x+dx,ny=y+dy;
if(nx>0&&nx<mw-1&&ny>0&&ny<mh-1&&maze[ny][nx]===1){
maze[y+dy/2][x+dx/2]=0;
carve(nx,ny);
}
}
};
carve(1,1);
for(let i=0;i<Math.floor(mw*mh*0.04);i++){
const rx=1+Math.floor(Math.random()*(mw-2));
const ry=1+Math.floor(Math.random()*(mh-2));
if(rx%2===0&&ry%2===0)maze[ry][rx]=0;
}
g.exit.x=mw-2;g.exit.y=mh-2;
maze[g.exit.y][g.exit.x]=0;
g.questionSpots=[];g.triggeredSpots=new Set();
const pathCells=[];
for(let y=0;y<mh;y++)for(let x=0;x<mw;x++)
if(maze[y][x]===0&&!(x===1&&y===1)&&!(x===g.exit.x&&y===g.exit.y))
pathCells.push({x,y});
pathCells.sort(()=>Math.random()-.5);
const numSpots=12+g.year*2;
for(let i=0;i<Math.min(numSpots,pathCells.length);i++)
g.questionSpots.push(pathCells[i]);
g.maze=maze;
recalcOffsets();
}

// ============================================================
// LOAD LEVEL
// ============================================================
function loadLevel(){
genMaze();
g.px=1;g.py=1;
g.rx=cellToPixX(1);g.ry=cellToPixY(1);
g.tx=g.rx;g.ty=g.ry;
g.moving=false;g.moveDir=null;g.moveProgress=0;
g.answered=0;g.exitLocked=true;
g.particles=[];
updateDots();
updateHUD();
const yearKey='year'+g.year;
const src=DB[yearKey]||DB.year1;
g.pool=[...src.qs].sort(()=>Math.random()-.5);
showNarrator(t('narrator3')+g.year+t('narrator4')+g.level+' ‚Äî '+t('narrator1'));
}

function cellToPixX(x){return g.cellOffX+x*g.cs+2}
function cellToPixY(y){return g.cellOffY+y*g.cs+2}

// ============================================================
// PLAYER MOVEMENT
// ============================================================
const MOVE_SPEED=0.14;
function tryMove(dx,dy){
if(g.moving||g.questionShowing||g.paused||!g.running)return;
const nx=g.px+dx,ny=g.py+dy;
if(nx<0||ny<0||nx>=g.mazeW||ny>=g.mazeH)return;
if(g.maze[ny][nx]!==0)return;
g.px=nx;g.py=ny;
g.tx=cellToPixX(nx);g.ty=cellToPixY(ny);
g.moving=true;g.moveProgress=0;
g.moveDir={dx,dy};
}

function updateMovement(dt){
if(!g.moving)return;
g.moveProgress+=MOVE_SPEED*(dt/16.67);
if(g.moveProgress>=1){
g.moveProgress=1;g.moving=false;
g.rx=g.tx;g.ry=g.ty;
checkCell();
}else{
g.rx=lerp(g.rx,g.tx,g.moveProgress);
g.ry=lerp(g.ry,g.ty,g.moveProgress);
}
}

function lerp(a,b,t){return a+(b-a)*t}

function checkCell(){
if(g.px===g.exit.x&&g.py===g.exit.y){
if(!g.exitLocked){levelComplete();return;}
else showNarrator(t('exitLocked'));
}
const spotKey=g.px+','+g.py;
if(!g.triggeredSpots.has(spotKey)){
const spot=g.questionSpots.find(s=>s.x===g.px&&s.y===g.py);
if(spot&&g.answered<3){
g.triggeredSpots.add(spotKey);
setTimeout(()=>showQuestion(),200);
}
}
}

// ============================================================
// QUESTION SYSTEM
// ============================================================
function showQuestion(){
if(g.answered>=3||g.questionShowing)return;
if(g.pool.length===0){
const yearKey='year'+g.year;
g.pool=[...DB[yearKey].qs].sort(()=>Math.random()-.5);
}
const q=g.pool.pop();
g.questionShowing=true;
const lang=g.lang;
const yearKey='year'+g.year;
document.getElementById('qTitle').textContent=t('questionTitle')||'MEDICAL QUESTION';
document.getElementById('qBadge').textContent=DB[yearKey].label[lang];
document.getElementById('qText').textContent=lang==='en'?q.en:q.fr;

// SHUFFLE OPTIONS
const options = lang==='en' ? q.a.en : q.a.fr;
const indices = [...Array(options.length).keys()];
for(let i=indices.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[indices[i],indices[j]]=[indices[j],indices[i]];
}
const shuffledOptions = indices.map(i=>options[i]);
g.currentCorrectIndex = indices.indexOf(q.ca);
g.currentExplanation = q.exp ? (lang==='en'?q.exp.en:q.exp.fr) : '';

const opts=document.getElementById('qOpts');
opts.innerHTML='';
shuffledOptions.forEach((opt,i)=>{
const btn=document.createElement('button');
btn.className='q-btn';
btn.textContent=(i===0?'A. ':i===1?'B. ':i===2?'C. ':'D. ')+opt;
btn.onclick=()=>handleAnswer(i,btn,opts,q);
opts.appendChild(btn);
});
document.getElementById('qFb').textContent='';
document.getElementById('qFb').className='q-feedback';
document.getElementById('qExplanation').textContent='';
document.getElementById('qExplanation').classList.remove('show');
document.getElementById('skipBtn').textContent=t('skip');
document.getElementById('skipBtn').disabled=false;
g.skipTimer=g.skipMax;
document.getElementById('skipBar').style.width='100%';
document.getElementById('qPanel').classList.add('active');
spawnParticles(g.W/2,g.H/2,'#00e5ff',8);
}

function handleAnswer(selected,clickedBtn,optsEl,q){
if(clickedBtn.disabled)return;
Array.from(optsEl.children).forEach(b=>b.disabled=true);
const fb=document.getElementById('qFb');
const expEl=document.getElementById('qExplanation');

if(selected===g.currentCorrectIndex){
clickedBtn.classList.add('correct');
const encouraging=t('encouraging');
const randomEnc=encouraging[Math.floor(Math.random()*encouraging.length)];
fb.textContent=randomEnc;
fb.className='q-feedback correct';
g.answered++;
g.score+=100*g.year+(g.streak*10);
g.streak++;
if(g.streak>5)Achievements.check('streak5');
if(g.streak>10)Achievements.check('streak10');
if(g.score>1000)Achievements.check('score1000');
if(g.score>5000)Achievements.check('score5000');

spawnParticles(g.W/2,g.H/2,'#2ecc71',20);
updateDots();updateHUD();

setTimeout(()=>{
closeQuestion();
if(g.answered>=3){
g.exitLocked=false;
showNarrator(t('exitOpen'));
spawnParticles(g.cellOffX+g.exit.x*g.cs+g.cs/2,g.cellOffY+g.exit.y*g.cs+g.cs/2,'#2ecc71',30);
autoSave();
}
},1500);
}else{
clickedBtn.classList.add('wrong');
if(optsEl.children[g.currentCorrectIndex]){
optsEl.children[g.currentCorrectIndex].classList.add('correct');
}
fb.textContent=t('wrong');
fb.className='q-feedback wrong';
g.score=Math.max(0,g.score-20);
g.streak=0;

if(g.currentExplanation){
expEl.textContent='üí° '+g.currentExplanation;
expEl.classList.add('show');
}

spawnParticles(g.rx+g.cs/2,g.ry+g.cs/2,'#e74c3c',12);
updateHUD();
setTimeout(()=>closeQuestion(),3000);
}
}

function closeQuestion(){
document.getElementById('qPanel').classList.remove('active');
g.questionShowing=false;
g.skipTimer=0;
g.currentCorrectIndex=-1;
g.currentExplanation='';
}

// ============================================================
// AUTO-SAVE SYSTEM
// ============================================================
function autoSave(){
const saveData={
playerName:g.playerName,
year:g.year,
level:g.level,
score:g.score,
answered:g.answered,
streak:g.streak,
lang:g.lang,
timestamp:Date.now()
};
if(SaveSystem.save(saveData)){
g.hasSave=true;
showSaveIndicator();
}
}

function showSaveIndicator(){
const indicator=document.getElementById('saveIndicator');
indicator.classList.add('show');
setTimeout(()=>indicator.classList.remove('show'),2000);
}

function loadSavedGame(){
const saved=SaveSystem.load();
if(saved){
g.playerName=saved.playerName||'';
g.year=saved.year||1;
g.level=saved.level||1;
g.score=saved.score||0;
g.answered=saved.answered||0;
g.streak=saved.streak||0;
g.lang=saved.lang||'en';
g.hasSave=true;
document.getElementById('playerNameInput').value=g.playerName;
return true;
}
return false;
}

function clearSavedGame(){
SaveSystem.clear();
g.hasSave=false;
g.playerName='';
document.getElementById('playerNameInput').value='';
}

// ============================================================
// LEVEL / YEAR COMPLETE
// ============================================================
function levelComplete(){
if(g.level<7){
g.level++;
loadLevel();
spawnParticles(g.W/2,g.H/2,'#f1c40f',30);
if(g.level===2&&g.year===1)Achievements.check('firstStep');
autoSave();
}else{
yearComplete();
}
}

function yearComplete(){
g.running=false;
const panel=document.getElementById('yearComp');
const tl=document.getElementById('ycTitle');
const tx=document.getElementById('ycText');
const btn=document.getElementById('nextYrBtn');
if(g.year===7){
tl.textContent=g.lang==='en'?'CONGRATULATIONS!':'F√âLICITATIONS !';
tx.textContent=g.lang==='en'?'You have completed ALL 7 years! You are now a Doctor!':"Vous avez termin√© les 7 ann√©es ! Vous √™tes Docteur !";
btn.textContent=g.lang==='en'?'RECEIVE CERTIFICATE':'RECEVOIR LE CERTIFICAT';
Achievements.check('year7');
}else{
tl.textContent=`${t('year')} ${g.year} ${t('yearComplete')}`;
tx.textContent=t('yearComp1')+g.year+t('yearComp2');
btn.textContent=t('nextYear')+' '+(g.lang==='en'?'Year ':'Ann√©e ')+(g.year+1);
if(g.year===1)Achievements.check('year1');
if(g.year===3)Achievements.check('year3');
}
panel.classList.add('active');
autoSave();
}

function showCertificate(){
document.getElementById('yearComp').classList.remove('active');
document.getElementById('certScreen').classList.add('active');
document.getElementById('certSchool').textContent=t('certSchool');
document.getElementById('certPresents').textContent=t('certPresents');
document.getElementById('certTL').textContent=t('certTitle');
document.getElementById('certBody').textContent=t('certBody');
document.getElementById('sigDean').textContent=t('sigDean');
document.getElementById('sigReg').textContent=t('sigReg');
const name=g.playerName||'GRADUATE';
document.getElementById('certName').textContent='DR. '+name.toUpperCase();
const now=new Date();
document.getElementById('certDate').textContent=now.toLocaleDateString(g.lang==='en'?'en-US':'fr-FR',{year:'numeric',month:'long',day:'numeric'});
g.graduated++;
localStorage.setItem('dq_grad',g.graduated);
document.getElementById('gradCount').textContent=g.graduated;
}

// ============================================================
// PARTICLE SYSTEM
// ============================================================
function spawnParticles(x,y,color,count){
for(let i=0;i<count;i++){
const angle=Math.random()*Math.PI*2;
const speed=1+Math.random()*4;
g.particles.push({
x,y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-1,
life:1,decay:.018+Math.random()*.025,
size:2+Math.random()*5,color
});
}
}

function updateParticles(dt){
const f=dt/16.67;
g.particles=g.particles.filter(p=>{
p.x+=p.vx*f;p.y+=p.vy*f;p.vy+=0.12*f;
p.life-=p.decay*f;
return p.life>0;
});
}

function drawParticles(){
const ctx=g.ctx;
g.particles.forEach(p=>{
ctx.save();
ctx.globalAlpha=p.life;
ctx.fillStyle=p.color;
ctx.beginPath();
ctx.arc(p.x,p.y,p.size*p.life,0,Math.PI*2);
ctx.fill();
ctx.restore();
});
}

// ============================================================
// ROBOT DRAWING
// ============================================================
function drawRobot(ctx,x,y,size){
const s=size;
const cx=x+s/2,cy=y+s/2;
g.robotTimer++;
if(g.robotTimer%18===0)g.robotFrame=(g.robotFrame+1)%4;
const bobY=Math.sin(g.robotFrame*Math.PI/2)*1.5;
const legSwing=Math.sin(g.robotFrame*Math.PI/2)*3;
g.eyeTimer++;
if(g.eyeTimer>90+Math.random()*60){
g.eyeOffset=Math.random()<.5?1:-1;
g.eyeTimer=0;
}
const ey=g.eyeOffset;
ctx.save();
ctx.translate(cx, cy+bobY);
ctx.save();
ctx.globalAlpha=0.3;
ctx.fillStyle='#000';
ctx.beginPath();
ctx.ellipse(0,s*.38,s*.28,s*.08,0,0,Math.PI*2);
ctx.fill();
ctx.restore();
ctx.fillStyle='#1a6090';
const legH=s*.22;
const legW=s*.13;
ctx.fillRect(-s*.19+legSwing*.5, s*.2, legW, legH);
ctx.fillRect( s*.06-legSwing*.5, s*.2, legW, legH);
ctx.fillStyle='#0d4060';
ctx.fillRect(-s*.22+legSwing*.5, s*.38, s*.18, s*.07);
ctx.fillRect( s*.04-legSwing*.5, s*.38, s*.18, s*.07);
const grad=ctx.createLinearGradient(-s*.28,-s*.15,s*.28,s*.22);
grad.addColorStop(0,'#4a9fd4');
grad.addColorStop(.5,'#2a7ab4');
grad.addColorStop(1,'#1a5a94');
ctx.fillStyle=grad;
ctx.beginPath();
ctx.roundRect(-s*.28,-s*.15,s*.56,s*.38,s*.06);
ctx.fill();
ctx.fillStyle='rgba(255,255,255,0.15)';
ctx.beginPath();
ctx.roundRect(-s*.24,-s*.12,s*.2,s*.1,s*.03);
ctx.fill();
ctx.fillStyle='#e74c3c';
ctx.fillRect(-s*.04,s*.0,s*.08,s*.16);
ctx.fillRect(-s*.1,s*.05,s*.2,s*.06);
ctx.fillStyle='#1a6090';
ctx.save();
ctx.translate(-s*.3,-s*.05);
ctx.rotate(Math.sin(g.robotFrame*Math.PI/2)*.25);
ctx.fillRect(-s*.1,0,s*.1,s*.25);
ctx.fillStyle='#0d4060';
ctx.beginPath();ctx.arc(-s*.05,s*.28,s*.08,0,Math.PI*2);ctx.fill();
ctx.restore();
ctx.save();
ctx.translate(s*.3,-s*.05);
ctx.rotate(-Math.sin(g.robotFrame*Math.PI/2)*.25);
ctx.fillRect(0,0,s*.1,s*.25);
ctx.fillStyle='#0d4060';
ctx.beginPath();ctx.arc(s*.05,s*.28,s*.08,0,Math.PI*2);ctx.fill();
ctx.restore();
ctx.fillStyle='#1a5a94';
ctx.fillRect(-s*.08,-s*.22,s*.16,s*.09);
const hgrad=ctx.createLinearGradient(-s*.25,-s*.48,s*.25,-s*.2);
hgrad.addColorStop(0,'#5ab0e0');
hgrad.addColorStop(1,'#2a80c0');
ctx.fillStyle=hgrad;
ctx.beginPath();
ctx.roundRect(-s*.25,-s*.48,s*.5,s*.29,s*.08);
ctx.fill();
ctx.fillStyle='#1a6090';
ctx.fillRect(-s*.08,-s*.52,s*.16,s*.06);
ctx.beginPath();ctx.arc(0,-s*.52,s*.06,0,Math.PI*2);
ctx.fillStyle='#f1c40f';ctx.fill();
ctx.strokeStyle='#0a3a60';ctx.lineWidth=2;
ctx.beginPath();ctx.moveTo(0,-s*.52);ctx.lineTo(0,-s*.62);ctx.stroke();
const blinkOn=(g.robotTimer%40<35);
ctx.beginPath();ctx.arc(0,-s*.64,s*.04,0,Math.PI*2);
ctx.fillStyle=blinkOn?'#e74c3c':'#7a1010';ctx.fill();
ctx.fillStyle='#050512';
ctx.beginPath();ctx.roundRect(-s*.18+ey,-s*.4,s*.14,s*.1,s*.03);ctx.fill();
ctx.beginPath();ctx.roundRect(s*.04+ey,-s*.4,s*.14,s*.1,s*.03);ctx.fill();
ctx.fillStyle='#00e5ff';
ctx.globalAlpha=0.9;
ctx.beginPath();ctx.arc(-s*.11+ey,-s*.35,s*.04,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc( s*.11+ey,-s*.35,s*.04,0,Math.PI*2);ctx.fill();
ctx.globalAlpha=0.4;
ctx.beginPath();ctx.arc(-s*.11+ey,-s*.35,s*.025,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc( s*.11+ey,-s*.35,s*.025,0,Math.PI*2);ctx.fill();
ctx.globalAlpha=1;
ctx.strokeStyle='#0a3a60';ctx.lineWidth=1.5;
ctx.beginPath();
ctx.moveTo(-s*.1,-s*.26);ctx.lineTo(-s*.03,-s*.22);
ctx.lineTo(s*.03,-s*.22);ctx.lineTo(s*.1,-s*.26);
ctx.stroke();
ctx.restore();
}

// ============================================================
// RENDER MAZE
// ============================================================
function drawMaze(){
const ctx=g.ctx,cs=g.cs;
const ox=g.cellOffX,oy=g.cellOffY;
const mw=g.mazeW,mh=g.mazeH;
const maze=g.maze;
ctx.fillStyle='#0a0a14';
ctx.fillRect(ox,oy,mw*cs,mh*cs);
for(let y=0;y<mh;y++){
for(let x=0;x<mw;x++){
const px=ox+x*cs,py=oy+y*cs;
if(maze[y][x]===1){
ctx.fillStyle='#1a1a30';
ctx.fillRect(px,py,cs,cs);
ctx.fillStyle='#141428';
ctx.fillRect(px+1,py+1,cs-2,cs-2);
ctx.fillStyle='#222240';
ctx.fillRect(px+1,py+1,cs-2,1);
ctx.fillRect(px+1,py+1,1,cs-2);
}else{
ctx.fillStyle=(x+y)%2===0?'#0d0d1c':'#0f0f1f';
ctx.fillRect(px,py,cs,cs);
ctx.strokeStyle='rgba(30,30,60,0.5)';
ctx.lineWidth=.5;
ctx.strokeRect(px+.5,py+.5,cs-1,cs-1);
}
}
}
g.questionSpots.forEach(sp=>{
const key=sp.x+','+sp.y;
if(g.triggeredSpots.has(key))return;
if(g.answered>=3)return;
const px=ox+sp.x*cs,py=oy+sp.y*cs;
const pulse=0.3+0.2*Math.sin(Date.now()*0.004);
ctx.fillStyle=`rgba(52,152,219,${pulse})`;
ctx.fillRect(px+3,py+3,cs-6,cs-6);
ctx.fillStyle=`rgba(0,229,255,${pulse+0.2})`;
ctx.font=`bold ${cs*.45}px var(--mono)`;
ctx.textAlign='center';ctx.textBaseline='middle';
ctx.fillText('?',px+cs/2,py+cs/2+1);
});
ctx.textAlign='left';ctx.textBaseline='alphabetic';
const ex=ox+g.exit.x*cs,ey=oy+g.exit.y*cs;
if(g.exitLocked){
const lp=0.6+0.2*Math.sin(Date.now()*0.003);
ctx.fillStyle=`rgba(231,76,60,${lp*0.6})`;
ctx.fillRect(ex,ey,cs,cs);
ctx.strokeStyle=`rgba(231,76,60,${lp})`;
ctx.lineWidth=2;ctx.strokeRect(ex+1,ey+1,cs-2,cs-2);
ctx.fillStyle=`rgba(231,76,60,${lp+0.1})`;
ctx.font=`bold ${cs*.5}px var(--mono)`;
ctx.textAlign='center';ctx.textBaseline='middle';
ctx.fillText('üîí',ex+cs/2,ey+cs/2);
}else{
const gp=0.5+0.3*Math.sin(Date.now()*0.005);
ctx.fillStyle=`rgba(46,204,113,${gp})`;
ctx.fillRect(ex,ey,cs,cs);
ctx.shadowColor='#2ecc71';ctx.shadowBlur=16;
ctx.strokeStyle='#2ecc71';ctx.lineWidth=2;
ctx.strokeRect(ex+1,ey+1,cs-2,cs-2);
ctx.shadowBlur=0;
ctx.fillStyle='#fff';
ctx.font=`bold ${cs*.55}px var(--mono)`;
ctx.textAlign='center';ctx.textBaseline='middle';
ctx.fillText('‚ñ∂',ex+cs/2,ey+cs/2);
}
ctx.textAlign='left';ctx.textBaseline='alphabetic';
}

// ============================================================
// MAIN RENDER
// ============================================================
function render(){
const ctx=g.ctx;
ctx.clearRect(0,0,g.W,g.H);
const bg=ctx.createRadialGradient(g.W/2,g.H*.6,0,g.W/2,g.H/2,g.W*.8);
bg.addColorStop(0,'#0d0d1e');bg.addColorStop(1,'#07070f');
ctx.fillStyle=bg;ctx.fillRect(0,0,g.W,g.H);
if(!g.running)return;
drawMaze();
drawParticles();
const rs=g.cs-2;
drawRobot(ctx,g.rx,g.ry,rs);
}

// ============================================================
// GAME LOOP
// ============================================================
function loop(ts){
if(!g.running){g.raf=null;return;}
const dt=Math.min(100,ts-g.lastTime);g.lastTime=ts;
if(!g.paused){
updateMovement(dt);
updateParticles(dt);
if(g.questionShowing&&g.skipTimer>0){
g.skipTimer-=dt;
const pct=Math.max(0,g.skipTimer/g.skipMax*100);
document.getElementById('skipBar').style.width=pct+'%';
if(g.skipTimer<=0)closeQuestion();
}
}
render();
g.raf=requestAnimationFrame(loop);
}

// ============================================================
// UI HELPERS
// ============================================================
function t(key){return T[g.lang][key]||T.en[key]||key}
function showNarrator(txt){
const el=document.getElementById('narrator');
el.textContent=txt;el.style.opacity='1';
clearTimeout(el._t);
el._t=setTimeout(()=>{if(el.textContent===txt)el.style.opacity='0';},4500);
}
function updateHUD(){
document.getElementById('vYear').textContent=g.year;
document.getElementById('vLevel').textContent=g.level;
document.getElementById('vScore').textContent=g.score;
document.getElementById('vStreak').textContent=g.streak;
const pct=((g.year-1)*7+(g.level-1)+(g.answered/3))/(7*7)*100;
document.getElementById('progFill').style.width=Math.min(100,pct)+'%';
const streakBadge=document.getElementById('hStreak');
if(g.streak>=2){
streakBadge.classList.add('active');
streakBadge.style.display='block';
}else{
streakBadge.classList.remove('active');
streakBadge.style.display='none';
}
}
function updateDots(){
for(let i=0;i<3;i++){
const d=document.getElementById('d'+i);
d.classList.toggle('lit',i<g.answered);
}
}

// ============================================================
// INIT GAME
// ============================================================
function startGame(){
const nameInput=document.getElementById('playerNameInput');
g.playerName=nameInput.value.trim()||'STUDENT';
document.getElementById('title').style.opacity='0';
setTimeout(()=>document.getElementById('title').classList.add('hidden'),600);
g.year=1;g.level=1;g.answered=0;g.score=0;g.streak=0;g.running=true;g.paused=false;
loadLevel();
g.rx=cellToPixX(g.px);g.ry=cellToPixY(g.py);
if(g.raf)cancelAnimationFrame(g.raf);
g.lastTime=performance.now();
g.raf=requestAnimationFrame(loop);
}

function continueGame(){
const nameInput=document.getElementById('playerNameInput');
g.playerName=nameInput.value.trim()||g.playerName||'STUDENT';
if(loadSavedGame()){
document.getElementById('title').style.opacity='0';
setTimeout(()=>document.getElementById('title').classList.add('hidden'),600);
g.running=true;g.paused=false;
loadLevel();
g.rx=cellToPixX(g.px);g.ry=cellToPixY(g.py);
if(g.raf)cancelAnimationFrame(g.raf);
g.lastTime=performance.now();
g.raf=requestAnimationFrame(loop);
showNarrator(t('saveLoaded')+g.playerName+'!');
}
}

// ============================================================
// EVENTS
// ============================================================
document.addEventListener('DOMContentLoaded',()=>{
initCanvas();
Achievements.load();
document.getElementById('gradCount').textContent=g.graduated;

// Check for saved game on load
if(SaveSystem.hasSave()){
const saved=SaveSystem.load();
if(saved){
document.getElementById('continueBtn').style.display='block';
const saveInfo=document.getElementById('saveInfo');
saveInfo.textContent=`üíæ ${t('year')} ${saved.year} ¬∑ ${t('level')} ${saved.level} ¬∑ ${t('score')}: ${saved.score}`;
saveInfo.classList.add('show');
g.playerName=saved.playerName||'';
document.getElementById('playerNameInput').value=g.playerName;
}
}

document.getElementById('startBtn').addEventListener('click',startGame);
document.getElementById('continueBtn').addEventListener('click',continueGame);
document.getElementById('langBtn').addEventListener('click',()=>{
g.lang=g.lang==='en'?'fr':'en';
document.getElementById('langBtn').textContent=t('langBtn');
document.getElementById('startBtn').textContent=t('startBtn');
document.getElementById('continueBtn').textContent=t('continueBtn');
document.getElementById('howBtn').textContent=t('howBtn');
document.getElementById('gradCount').textContent=g.graduated;
});
document.getElementById('howBtn').addEventListener('click',()=>{
alert(t('howToPlay'));
});
document.getElementById('pauseBtn').addEventListener('click',()=>{
if(!g.running)return;
g.paused=!g.paused;
document.getElementById('pauseMenu').classList.toggle('active',g.paused);
document.getElementById('pTitle').textContent=t('paused');
document.getElementById('resumeBtn').textContent=t('resume');
document.getElementById('rstBtn').textContent=t('restart');
document.getElementById('quitBtn').textContent=t('quit');
// Update pause menu info
document.getElementById('pausePlayerName').textContent=g.playerName||'-';
document.getElementById('pauseYear').textContent=g.year;
document.getElementById('pauseLevel').textContent=g.level;
document.getElementById('pauseScore').textContent=g.score;
});
document.getElementById('resumeBtn').addEventListener('click',()=>{
g.paused=false;document.getElementById('pauseMenu').classList.remove('active');
});
document.getElementById('rstBtn').addEventListener('click',()=>{
g.paused=false;document.getElementById('pauseMenu').classList.remove('active');
loadLevel();
g.rx=cellToPixX(g.px);g.ry=cellToPixY(g.py);
if(!g.raf){g.lastTime=performance.now();g.raf=requestAnimationFrame(loop);}
});
document.getElementById('quitBtn').addEventListener('click',()=>{
autoSave();
g.running=false;g.paused=false;
document.getElementById('pauseMenu').classList.remove('active');
document.getElementById('title').classList.remove('hidden');
document.getElementById('title').style.opacity='1';
if(g.raf){cancelAnimationFrame(g.raf);g.raf=null;}
// Update save info display
if(SaveSystem.hasSave()){
const saved=SaveSystem.load();
if(saved){
document.getElementById('continueBtn').style.display='block';
const saveInfo=document.getElementById('saveInfo');
saveInfo.textContent=`üíæ ${t('year')} ${saved.year} ¬∑ ${t('level')} ${saved.level} ¬∑ ${t('score')}: ${saved.score}`;
saveInfo.classList.add('show');
}
}
});
document.getElementById('skipBtn').addEventListener('click',closeQuestion);
document.getElementById('nextYrBtn').addEventListener('click',()=>{
document.getElementById('yearComp').classList.remove('active');
if(g.year===7){showCertificate();return;}
g.year++;g.level=1;g.answered=0;g.streak=0;g.running=true;
loadLevel();
g.rx=cellToPixX(g.px);g.ry=cellToPixY(g.py);
if(g.raf)cancelAnimationFrame(g.raf);
g.lastTime=performance.now();
g.raf=requestAnimationFrame(loop);
});
document.getElementById('dlBtn').addEventListener('click',()=>{
alert(g.lang==='en'?'üéì Certificate saved! You are officially a Doctor!':'üéì Certificat enregistr√© ! Vous √™tes officiellement Docteur !');
});
document.getElementById('playAgainBtn').addEventListener('click',()=>{
clearSavedGame();
document.getElementById('certScreen').classList.remove('active');
document.getElementById('title').classList.remove('hidden');
document.getElementById('title').style.opacity='1';
document.getElementById('continueBtn').style.display='none';
document.getElementById('saveInfo').classList.remove('show');
document.getElementById('playerNameInput').value='';
});
// Keyboard controls
document.addEventListener('keydown',(e)=>{
if(!g.running||g.paused||g.questionShowing)return;
switch(e.key){
case'ArrowUp':case'w':case'W':tryMove(0,-1);break;
case'ArrowDown':case's':case'S':tryMove(0,1);break;
case'ArrowLeft':case'a':case'A':tryMove(-1,0);break;
case'ArrowRight':case'd':case'D':tryMove(1,0);break;
case'Escape':case'p':case'P':
g.paused=!g.paused;
document.getElementById('pauseMenu').classList.toggle('active',g.paused);
break;
}
});
// Auto-save every 30 seconds
setInterval(()=>{
if(g.running&&!g.paused){
autoSave();
}
},30000);
render();
});
</script>
</body>
</html>

